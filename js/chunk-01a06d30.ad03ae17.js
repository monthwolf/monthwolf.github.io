(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-01a06d30"],{"0615":function(e,t,s){"use strict";s("400f")},"0716":function(e,t,s){"use strict";s("4eff")},"0c24":function(e,t,s){},"11e9":function(e,t,s){var r=s("52a7"),i=s("4630"),o=s("6821"),n=s("6a99"),a=s("69a8"),c=s("c69a"),l=Object.getOwnPropertyDescriptor;t.f=s("9e1e")?l:function(e,t){if(e=o(e),t=n(t,!0),c)try{return l(e,t)}catch(s){}if(a(e,t))return i(!r.f.call(e,t),e[t])}},"12a8":function(e,t,s){},"13c8":function(e,t,s){"use strict";s("3528")},"195f":function(e,t,s){"use strict";s("9380")},"19d7":function(e,t,s){},2158:function(e,t,s){},2415:function(e,t,s){"use strict";s("9c9f")},2425:function(e,t,s){"use strict";s("4047")},"24c8":function(e,t,s){"use strict";s("e8d4")},"29bd":function(e,t,s){"use strict";s("3755")},"2f14":function(e,t,s){},3528:function(e,t,s){},3755:function(e,t,s){},3763:function(e,t,s){"use strict";s("c964")},"3b2b":function(e,t,s){var r=s("7726"),i=s("5dbc"),o=s("86cc").f,n=s("9093").f,a=s("aae3"),c=s("0bfb"),l=r.RegExp,u=l,p=l.prototype,m=/a/g,h=/a/g,d=new l(m)!==m;if(s("9e1e")&&(!d||s("79e5")((function(){return h[s("2b4c")("match")]=!1,l(m)!=m||l(h)==h||"/a/i"!=l(m,"i")})))){l=function(e,t){var s=this instanceof l,r=a(e),o=void 0===t;return!s&&r&&e.constructor===l&&o?e:i(d?new u(r&&!o?e.source:e,t):u((r=e instanceof l)?e.source:e,r&&o?c.call(e):t),s?this:p,l)};for(var g=function(e){e in l||o(l,e,{configurable:!0,get:function(){return u[e]},set:function(t){u[e]=t}})},f=n(u),b=0;f.length>b;)g(f[b++]);p.constructor=l,l.prototype=p,s("2aba")(r,"RegExp",l)}s("7a56")("RegExp")},"400f":function(e,t,s){},4011:function(e,t,s){"use strict";s("7a62")},4047:function(e,t,s){},"41d8":function(e,t,s){},"43c2":function(e,t,s){},"47b1":function(e,t,s){"use strict";s("9908")},"4ce1":function(e,t,s){"use strict";s("2f14")},"4d06":function(e,t,s){"use strict";s("0c24")},"4eff":function(e,t,s){},"52a7":function(e,t){t.f={}.propertyIsEnumerable},"53b9":function(e,t,s){},"550c":function(e,t,s){"use strict";s("bdf2")},5903:function(e,t,s){},"59b9":function(e,t,s){"use strict";s("98e8")},"5b99":function(e,t,s){"use strict";s("5903")},"5bcc":function(e,t,s){},"5dbc":function(e,t,s){var r=s("d3f4"),i=s("8b97").set;e.exports=function(e,t,s){var o,n=t.constructor;return n!==s&&"function"==typeof n&&(o=n.prototype)!==s.prototype&&r(o)&&i&&i(e,o),e}},6044:function(e,t,s){},"6d42":function(e,t,s){},7028:function(e,t,s){"use strict";s("9290")},"762d":function(e,t,s){"use strict";s("19d7")},"76e5":function(e,t,s){},"777c":function(e,t,s){"use strict";s("c1f9")},"78e0":function(e,t,s){},7982:function(e,t,s){},"7a56":function(e,t,s){"use strict";var r=s("7726"),i=s("86cc"),o=s("9e1e"),n=s("2b4c")("species");e.exports=function(e){var t=r[e];o&&t&&!t[n]&&i.f(t,n,{configurable:!0,get:function(){return this}})}},"7a62":function(e,t,s){},"7ba6":function(e,t,s){"use strict";s("5bcc")},"831a":function(e,t,s){"use strict";s("12a8")},"852a":function(e,t,s){},"854e":function(e,t,s){},8674:function(e,t,s){"use strict";s("78e0")},"86b5":function(e,t,s){"use strict";s("b8dc")},"873f":function(e,t,s){"use strict";s("a396")},8810:function(e,t,s){"use strict";s("2158")},"8a99":function(e,t,s){},"8b97":function(e,t,s){var r=s("d3f4"),i=s("cb7c"),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{r=s("9b43")(Function.call,s("11e9").f(Object.prototype,"__proto__").set,2),r(e,[]),t=!(e instanceof Array)}catch(i){t=!0}return function(e,s){return o(e,s),t?e.__proto__=s:r(e,s),e}}({},!1):void 0),check:o}},"8d5d":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-row",[s("el-col",{attrs:{span:5}},[s("profile-bar"),s("side-bar")],1),s("el-col",{attrs:{span:19}},[e.showCurrentConversation?s("current-conversation"):s("div",{staticClass:"conversation-empty"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$store.commit("updateCreateGroupModelVisible",!0)}}},[e._v(">> 发起跑团 <<")])],1)],1),s("image-previewer")],1)},i=[],o=(s("ac6a"),s("bd86")),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"current-conversation-wrapper scene-bg",style:"background-image: url("+e.backgroundUrl+")"},[s("div",{staticClass:"current-conversation",on:{scroll:e.onScroll}},[s("div",{staticClass:"header background-blur"},[s("div",{staticClass:"name"},[e._v(e._s(e.name))])]),s("div",{staticClass:"content scene-bg"},[s("div",{ref:"message-list",staticClass:"message-list",on:{scroll:this.onScroll}},[e.isCompleted?s("div",{staticClass:"no-more"},[e._v("没有更多了")]):s("div",{staticClass:"more"},[s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.$store.dispatch("getMessageList",e.currentConversation.conversationID)}}},[e._v("查看更多")])],1),e._l(e.currentMessageList,(function(e){return s("message-item",{key:e.ID,attrs:{message:e}})}))],2),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowScrollButtomTips,expression:"isShowScrollButtomTips"}],staticClass:"newMessageTips",on:{click:e.scrollMessageListToButtom}},[e._v("回到最新位置")])]),e.showMessageSendBox?s("div",{staticClass:"footer"},[s("message-send-box")],1):e._e()]),e.showConversationProfile?s("div",{staticClass:"profile"},[e.currentConversation.type===e.TIM.TYPES.CONV_GROUP?s("right-panel"):s("conversation-profile")],1):e._e(),s("member-profile-card")],1)},a=[],c=s("5880"),l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"background-blur",attrs:{id:"message-send-box-wrapper"},on:{drop:e.dropHandler}},[s("div",{staticClass:"send-header-bar"},[s("el-popover",{attrs:{placement:"top",width:"400",trigger:"click"}},[s("div",{staticClass:"emojis"},e._l(e.emojiName,(function(t){return s("div",{key:t,staticClass:"emoji",on:{click:function(s){return e.chooseEmoji(t)}}},[s("img",{staticStyle:{width:"30px",height:"30px"},attrs:{src:e.emojiUrl+e.emojiMap[t]}})])})),0),s("i",{staticClass:"iconfont icon-smile",attrs:{slot:"reference",title:"发表情"},slot:"reference"})]),s("i",{staticClass:"iconfont icon-tupian",attrs:{title:"发图片"},on:{click:e.handleSendImageClick}}),s("i",{staticClass:"el-icon-camera",attrs:{title:"发视频"},on:{click:e.handleSendVideoClick}}),s("i",{staticClass:"iconfont icon-wenjian",attrs:{title:"发文件"},on:{click:e.handleSendFileClick}}),s("i",{staticClass:"el-icon-warning-outline",attrs:{title:"骰子指南"},on:{click:function(t){e.showDiceUsageVisible=!0}}})],1),s("el-dialog",{attrs:{title:"🎲 如何使用骰子",visible:e.showDiceUsageVisible,width:"40%","append-to-body":""},on:{"update:visible":function(t){e.showDiceUsageVisible=t}}},[s("div",{staticClass:"dice-usage"},[s("div",[e._v("首先请确保群主启用了群机器人。在启用机器人后，机器人会对群里的骰子指令做出响应。")]),s("div",[e._v("骰子指令以小数点开头（中文句号亦可），接一个合法的骰子表达式。机器人支持多种常见的骰子表达式，有关表达式的细节可以\n          "),s("el-link",{staticClass:"inline-link",attrs:{type:"primary",href:"https://greenimp.github.io/rpg-dice-roller/guide/notation/",target:"_blank",underline:!1}},[e._v("参考详细文档")]),e._v("。\n        ")],1),s("div",[e._v("常用指令：")]),s("ul",[s("li",[e._v("基础骰子："),s("span",[e._v(".d6")]),e._v(" → 投掷一个六面骰（骰子面数可替换为任意数字）")]),s("li",[e._v("百分骰："),s("span",[e._v(".d%")]),e._v(" → 投掷一个百分骰，等同于 "),s("span",[e._v(".d100")])]),s("li",[e._v("骰子组合："),s("span",[e._v(".2d6+d4")]),e._v(" → 投掷两个六面骰和一个四面骰（支持同时多个骰子和基础运算）")]),s("li",[e._v("COC 奖励骰："),s("span",[e._v(".2d%kl1")]),e._v(" → 投掷两个百分骰，并保留（"),s("b",[e._v("k")]),e._v("eep）最低（"),s("b",[e._v("l")]),e._v("owest）的一个")]),s("li",[e._v("Fate 骰子："),s("span",[e._v(".4dF")]),e._v(" → 投掷四个 Fate 规则的骰子")])]),s("div",[e._v("在骰子表达式后面可以接上动作的描述，以增强指令的可读性，并可以与人物卡联动，例如 "),s("span",[e._v(".d% 聆听")]),e._v(" 。")])])]),s("div",{staticClass:"bottom"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.messageContent,expression:"messageContent"}],ref:"text-input",staticClass:"text-input",attrs:{rows:"4",resize:"false"},domProps:{value:e.messageContent},on:{focus:function(t){e.focus=!0},blur:function(t){e.focus=!1},keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),e.handleEnter(t))},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?(t.preventDefault(),t.shiftKey||t.altKey||t.metaKey?null:e.handleLine(t)):null},input:function(t){t.target.composing||(e.messageContent=t.target.value)}}}),s("ghost-message-send-box",{attrs:{"to-account":e.toAccount,"current-conversation-type":e.currentConversationType}}),s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"按Enter发送消息，Ctrl+Enter换行",placement:"left-start"}},[s("div",{staticClass:"btn-send",on:{click:e.sendTextMessage}},[s("div",{staticClass:"tim-icon-send"})])])],1),s("input",{ref:"imagePicker",staticStyle:{display:"none"},attrs:{type:"file",id:"imagePicker",accept:".jpg, .jpeg, .png, .gif, .bmp"},on:{change:e.sendImage}}),s("input",{ref:"filePicker",staticStyle:{display:"none"},attrs:{type:"file",id:"filePicker"},on:{change:e.sendFile}}),s("input",{ref:"videoPicker",staticStyle:{display:"none"},attrs:{type:"file",id:"videoPicker",accept:".mp4"},on:{change:e.sendVideo}})],1)},u=[],p=(s("fe90"),s("5f72"));const m="https://imgcache.qq.com/open/qcloud/tim/assets/emoji/",h={"[NO]":"emoji_0@2x.png","[OK]":"emoji_1@2x.png","[下雨]":"emoji_2@2x.png","[么么哒]":"emoji_3@2x.png","[乒乓]":"emoji_4@2x.png","[便便]":"emoji_5@2x.png","[信封]":"emoji_6@2x.png","[偷笑]":"emoji_7@2x.png","[傲慢]":"emoji_8@2x.png","[再见]":"emoji_9@2x.png","[冷汗]":"emoji_10@2x.png","[凋谢]":"emoji_11@2x.png","[刀]":"emoji_12@2x.png","[删除]":"emoji_13@2x.png","[勾引]":"emoji_14@2x.png","[发呆]":"emoji_15@2x.png","[发抖]":"emoji_16@2x.png","[可怜]":"emoji_17@2x.png","[可爱]":"emoji_18@2x.png","[右哼哼]":"emoji_19@2x.png","[右太极]":"emoji_20@2x.png","[右车头]":"emoji_21@2x.png","[吐]":"emoji_22@2x.png","[吓]":"emoji_23@2x.png","[咒骂]":"emoji_24@2x.png","[咖啡]":"emoji_25@2x.png","[啤酒]":"emoji_26@2x.png","[嘘]":"emoji_27@2x.png","[回头]":"emoji_28@2x.png","[困]":"emoji_29@2x.png","[坏笑]":"emoji_30@2x.png","[多云]":"emoji_31@2x.png","[大兵]":"emoji_32@2x.png","[大哭]":"emoji_33@2x.png","[太阳]":"emoji_34@2x.png","[奋斗]":"emoji_35@2x.png","[奶瓶]":"emoji_36@2x.png","[委屈]":"emoji_37@2x.png","[害羞]":"emoji_38@2x.png","[尴尬]":"emoji_39@2x.png","[左哼哼]":"emoji_40@2x.png","[左太极]":"emoji_41@2x.png","[左车头]":"emoji_42@2x.png","[差劲]":"emoji_43@2x.png","[弱]":"emoji_44@2x.png","[强]":"emoji_45@2x.png","[彩带]":"emoji_46@2x.png","[彩球]":"emoji_47@2x.png","[得意]":"emoji_48@2x.png","[微笑]":"emoji_49@2x.png","[心碎了]":"emoji_50@2x.png","[快哭了]":"emoji_51@2x.png","[怄火]":"emoji_52@2x.png","[怒]":"emoji_53@2x.png","[惊恐]":"emoji_54@2x.png","[惊讶]":"emoji_55@2x.png","[憨笑]":"emoji_56@2x.png","[手枪]":"emoji_57@2x.png","[打哈欠]":"emoji_58@2x.png","[抓狂]":"emoji_59@2x.png","[折磨]":"emoji_60@2x.png","[抠鼻]":"emoji_61@2x.png","[抱抱]":"emoji_62@2x.png","[抱拳]":"emoji_63@2x.png","[拳头]":"emoji_64@2x.png","[挥手]":"emoji_65@2x.png","[握手]":"emoji_66@2x.png","[撇嘴]":"emoji_67@2x.png","[擦汗]":"emoji_68@2x.png","[敲打]":"emoji_69@2x.png","[晕]":"emoji_70@2x.png","[月亮]":"emoji_71@2x.png","[棒棒糖]":"emoji_72@2x.png","[汽车]":"emoji_73@2x.png","[沙发]":"emoji_74@2x.png","[流汗]":"emoji_75@2x.png","[流泪]":"emoji_76@2x.png","[激动]":"emoji_77@2x.png","[灯泡]":"emoji_78@2x.png","[炸弹]":"emoji_79@2x.png","[熊猫]":"emoji_80@2x.png","[爆筋]":"emoji_81@2x.png","[爱你]":"emoji_82@2x.png","[爱心]":"emoji_83@2x.png","[爱情]":"emoji_84@2x.png","[猪头]":"emoji_85@2x.png","[猫咪]":"emoji_86@2x.png","[献吻]":"emoji_87@2x.png","[玫瑰]":"emoji_88@2x.png","[瓢虫]":"emoji_89@2x.png","[疑问]":"emoji_90@2x.png","[白眼]":"emoji_91@2x.png","[皮球]":"emoji_92@2x.png","[睡觉]":"emoji_93@2x.png","[磕头]":"emoji_94@2x.png","[示爱]":"emoji_95@2x.png","[礼品袋]":"emoji_96@2x.png","[礼物]":"emoji_97@2x.png","[篮球]":"emoji_98@2x.png","[米饭]":"emoji_99@2x.png","[糗大了]":"emoji_100@2x.png","[红双喜]":"emoji_101@2x.png","[红灯笼]":"emoji_102@2x.png","[纸巾]":"emoji_103@2x.png","[胜利]":"emoji_104@2x.png","[色]":"emoji_105@2x.png","[药]":"emoji_106@2x.png","[菜刀]":"emoji_107@2x.png","[蛋糕]":"emoji_108@2x.png","[蜡烛]":"emoji_109@2x.png","[街舞]":"emoji_110@2x.png","[衰]":"emoji_111@2x.png","[西瓜]":"emoji_112@2x.png","[调皮]":"emoji_113@2x.png","[象棋]":"emoji_114@2x.png","[跳绳]":"emoji_115@2x.png","[跳跳]":"emoji_116@2x.png","[车厢]":"emoji_117@2x.png","[转圈]":"emoji_118@2x.png","[鄙视]":"emoji_119@2x.png","[酷]":"emoji_120@2x.png","[钞票]":"emoji_121@2x.png","[钻戒]":"emoji_122@2x.png","[闪电]":"emoji_123@2x.png","[闭嘴]":"emoji_124@2x.png","[闹钟]":"emoji_125@2x.png","[阴险]":"emoji_126@2x.png","[难过]":"emoji_127@2x.png","[雨伞]":"emoji_128@2x.png","[青蛙]":"emoji_129@2x.png","[面条]":"emoji_130@2x.png","[鞭炮]":"emoji_131@2x.png","[风车]":"emoji_132@2x.png","[飞吻]":"emoji_133@2x.png","[飞机]":"emoji_134@2x.png","[饥饿]":"emoji_135@2x.png","[香蕉]":"emoji_136@2x.png","[骷髅]":"emoji_137@2x.png","[麦克风]":"emoji_138@2x.png","[麻将]":"emoji_139@2x.png","[鼓掌]":"emoji_140@2x.png","[龇牙]":"emoji_141@2x.png"},d=["[龇牙]","[调皮]","[流汗]","[偷笑]","[再见]","[敲打]","[擦汗]","[猪头]","[玫瑰]","[流泪]","[大哭]","[嘘]","[酷]","[抓狂]","[委屈]","[便便]","[炸弹]","[菜刀]","[可爱]","[色]","[害羞]","[得意]","[吐]","[微笑]","[怒]","[尴尬]","[惊恐]","[冷汗]","[爱心]","[示爱]","[白眼]","[傲慢]","[难过]","[惊讶]","[疑问]","[困]","[么么哒]","[憨笑]","[爱情]","[衰]","[撇嘴]","[阴险]","[奋斗]","[发呆]","[右哼哼]","[抱抱]","[坏笑]","[飞吻]","[鄙视]","[晕]","[大兵]","[可怜]","[强]","[弱]","[握手]","[胜利]","[抱拳]","[凋谢]","[米饭]","[蛋糕]","[西瓜]","[啤酒]","[瓢虫]","[勾引]","[OK]","[爱你]","[咖啡]","[月亮]","[刀]","[发抖]","[差劲]","[拳头]","[心碎了]","[太阳]","[礼物]","[皮球]","[骷髅]","[挥手]","[闪电]","[饥饿]","[咒骂]","[折磨]","[抠鼻]","[鼓掌]","[糗大了]","[左哼哼]","[打哈欠]","[快哭了]","[吓]","[篮球]","[乒乓]","[NO]","[跳跳]","[怄火]","[转圈]","[磕头]","[回头]","[跳绳]","[激动]","[街舞]","[献吻]","[左太极]","[右太极]","[闭嘴]","[猫咪]","[红双喜]","[鞭炮]","[红灯笼]","[麻将]","[麦克风]","[礼品袋]","[信封]","[象棋]","[彩带]","[蜡烛]","[爆筋]","[棒棒糖]","[奶瓶]","[面条]","[香蕉]","[飞机]","[左车头]","[车厢]","[右车头]","[多云]","[下雨]","[钞票]","[熊猫]","[灯泡]","[风车]","[闹钟]","[雨伞]","[彩球]","[钻戒]","[沙发]","[纸巾]","[手枪]","[青蛙]"];var g=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"ghost",staticStyle:{display:"none"},attrs:{id:"ghost-message-send-box"},on:{click:e.send}})},f=[],b={props:["toAccount","currentConversationType"],methods:{send(){const e=this.$refs.ghost.innerText;if(0===e.trim().length)return;const t=this.tim.createTextMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{text:e}});this.$store.commit("pushCurrentMessageList",t),this.$bus.$emit("scroll-bottom"),this.tim.sendMessage(t).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})}),this.$refs.ghost.innerText=""}}},v=b,y=s("2877"),O=Object(y["a"])(v,g,f,!1,null,null,null),C=O.exports;function w(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function _(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?w(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):w(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var P={name:"message-send-box",props:["scrollMessageListToButtom"],components:{ElInput:p["Input"],ElForm:p["Form"],ElFormItem:p["FormItem"],ElDialog:p["Dialog"],ElPopover:p["Popover"],ElRadioGroup:p["RadioGroup"],ElRadio:p["Radio"],ElTooltip:p["Tooltip"],ElRate:p["Rate"],GhostMessageSendBox:C},data(){return{callingList:[],callingType:"",showCallingMember:!1,colors:["#99A9BF","#F7BA2A","#FF9900"],messageContent:"",isSendCustomMessage:!1,sendCustomDialogVisible:!1,surveyDialogVisible:!1,showDiceUsageVisible:!1,form:{data:"",description:"",extension:""},rate:5,suggestion:"",file:"",emojiMap:h,emojiName:d,emojiUrl:m,showAtGroupMember:!1,atUserID:"",focus:!1}},computed:_(_({},Object(c["mapGetters"])(["toAccount","currentConversationType"])),Object(c["mapState"])({memberList:e=>e.group.currentMemberList,userID:e=>e.user.userID,groupProfile:e=>e.conversation.currentConversation.groupProfile})),mounted(){this.$refs["text-input"].addEventListener("paste",this.handlePaste),this.$bus.$on("reEditMessage",this.reEditMessage)},beforeDestroy(){this.$refs["text-input"].removeEventListener("paste",this.handlePaste)},methods:{getList(e){this.callingList=e},cancelCalling(){this.showCallingMember=!1},callingHandler(){if(this.callingList.length<1)return void this.$store.commit("showMessage",{type:"warning",message:"请选择成员"});this.showCallingMember=!1;let e={memberList:this.callingList,type:this.TIM.TYPES.CONV_GROUP};this.$store.commit("setCallingList",e),"video"!==this.callingType?"audio"!==this.callingType||this.$bus.$emit("audio-call"):this.$bus.$emit("video-call")},trtcCalling(e){if("video"===e&&(this.callingType="video"),"audio"===e&&(this.callingType="audio"),"C2C"===this.currentConversationType){let t=[this.toAccount],s={memberList:t,type:"C2C"};return this.$store.commit("setCallingList",s),void this.$bus.$emit(e+"-call")}this.currentConversationType===this.TIM.TYPES.CONV_GROUP&&(this.showCallingMember=!0)},audioCall(){this.$bus.$emit("audio-call"),this.$store.commit("showAudioCall",!0)},handleEmojiShow(){this.emojiShow=!0,this.bigEmojiShow=!1},handleBigEmojiShow(e){let t=document.getElementById("bigEmojiBox");t&&(t.scrollTop=0),this.curItemIndex=e,this.curBigEmojiItemList=this.bigEmojiList[e].list,this.emojiShow=!1,this.bigEmojiShow=!0},chooseBigEmoji(e){this.popoverVisible=!1;let t=this.tim.createFaceMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{index:this.curItemIndex+1,data:e+"@2x"}});this.$store.commit("pushCurrentMessageList",t),this.$bus.$emit("scroll-bottom"),this._sendMessage(t).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},reEditMessage(e){this.messageContent=e},handleSelectAtUser(){this.messageContent+=this.atUserID+" ",this.showAtGroupMember=!1},handleUp(){const e=this.memberList.findIndex(e=>e.userID===this.atUserID);e-1<0||(this.atUserID=this.memberList[e-1].userID)},handleDown(){const e=this.memberList.findIndex(e=>e.userID===this.atUserID);e+1>=this.memberList.length||(this.atUserID=this.memberList[e+1].userID)},handleEnter(){this.showAtGroupMember?this.handleSelectAtUser():this.sendTextMessage()},handleLine(){this.messageContent+="\n"},handlePaste(e){let t,s=e.clipboardData;if(s&&s.files&&s.files.length>0&&(t=s.files[0]),"undefined"===typeof t)return;let r=this.tim.createImageMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:t},onProgress:e=>{this.$set(r,"progress",e)}});this.$store.commit("pushCurrentMessageList",r);let i=this._sendMessage(r);i.catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},dropHandler(e){e.preventDefault();let t=e.dataTransfer.files[0],s={};s="video/mp4"===t.type?this.tim.createVideoMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:t},onProgress:e=>{this.$set(s,"progress",e)}}):this.tim.createFileMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:t},onProgress:e=>{this.$set(s,"progress",e)}}),this.$store.commit("pushCurrentMessageList",s),this._sendMessage(s).then(()=>{this.$refs.videoPicker.value=null}).catch(e=>{this.$store.commit("showMessage",{message:e.message,type:"error"})})},sendTextMessage(){if(""===this.messageContent||0===this.messageContent.trim().length)return this.messageContent="",void this.$store.commit("showMessage",{message:"不能发送空消息哦！",type:"info"});const e=this.tim.createTextMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{text:this.messageContent}});this.$store.commit("pushCurrentMessageList",e),this.$bus.$emit("scroll-bottom"),this._sendMessage(e).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})}),this.messageContent=""},sendCustomMessage(){if(0===this.form.data.length&&0===this.form.description.length&&0===this.form.extension.length)return void this.$store.commit("showMessage",{message:"不能发送空消息",type:"info"});const e=this.tim.createCustomMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{data:this.form.data,description:this.form.description,extension:this.form.extension}});this.$store.commit("pushCurrentMessageList",e),this._sendMessage(e).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})}),Object.assign(this.form,{data:"",description:"",extension:""}),this.sendCustomDialogVisible=!1},random(e,t){return Math.floor(Math.random()*(t-e+1)+e)},sendSurvey(){const e=this.tim.createCustomMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{data:"survey",description:String(this.rate),extension:this.suggestion}});this.$store.commit("pushCurrentMessageList",e),Object.assign(this.form,{data:"",description:"",extension:""}),this._sendMessage(e).then(()=>{Object.assign(this,{rate:5,suggestion:""})}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})}),this.surveyDialogVisible=!1},chooseEmoji(e){this.messageContent+=e},handleSendImageClick(){this.$refs.imagePicker.click()},handleSendFileClick(){this.$refs.filePicker.click()},handleSendVideoClick(){this.$refs.videoPicker.click()},groupLive(){this.$store.commit("updateGroupLiveInfo",{groupID:this.toAccount,anchorID:this.userID}),this.$bus.$emit("open-group-live",{channel:1})},sendImage(){const e=this.tim.createImageMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:document.getElementById("imagePicker")},onProgress:t=>{this.$set(e,"progress",t)}});this.$store.commit("pushCurrentMessageList",e),this._sendMessage(e).then(()=>{this.$refs.imagePicker.value=null}).catch(e=>{this.$store.commit("showMessage",{message:e.message,type:"error"})})},sendFile(){const e=this.tim.createFileMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:document.getElementById("filePicker")},onProgress:t=>{this.$set(e,"progress",t)}});this.$store.commit("pushCurrentMessageList",e),this._sendMessage(e).then(()=>{this.$refs.filePicker.value=null}).catch(e=>{this.$store.commit("showMessage",{message:e.message,type:"error"})})},sendVideo(){const e=this.tim.createVideoMessage({to:this.toAccount,conversationType:this.currentConversationType,payload:{file:document.getElementById("videoPicker")},onProgress:t=>{this.$set(e,"progress",t)}});this.$store.commit("pushCurrentMessageList",e),this._sendMessage(e).then(()=>{this.$refs.videoPicker.value=null}).catch(e=>{this.$store.commit("showMessage",{message:e.message,type:"error"})})},_sendMessage(e){return this.tim.sendMessage(e).then(t=>(this.$store.dispatch("insertGameLogs",[e]),t))}}},j=P,M=(s("0615"),Object(y["a"])(j,l,u,!1,null,"5b6f3afd",null)),I=M.exports,x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message-wrapper",class:e.messagePosition},[e.currentConversationType===e.TIM.TYPES.CONV_C2C?s("div",{staticClass:"c2c-layout",class:e.messagePosition},[e.showAvatar?s("div",{staticClass:"col-1"},[s("avatar",{attrs:{src:e.avatar}})],1):e._e(),s("div",{staticClass:"col-2"},[s("div",{staticClass:"content-wrapper"},[e.isMine?s("message-status-icon",{attrs:{message:e.message}}):e._e(),e.message.type===e.TIM.TYPES.MSG_TEXT?s("text-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_IMAGE?s("image-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FILE?s("file-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_SOUND?s("sound-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_TIP?s("group-tip-element",{attrs:{payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_SYS_NOTICE?s("group-system-notice-element",{attrs:{payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_CUSTOM?s("custom-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FACE?s("face-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_VIDEO?s("video-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GEO?s("geo-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):s("span",[e._v("暂未支持的消息类型："+e._s(e.message.type))])],1),e.showMessageHeader?s("message-footer",{attrs:{message:e.message}}):e._e()],1),s("div",{staticClass:"col-3"})]):e._e(),e.currentConversationType===e.TIM.TYPES.CONV_GROUP?s("div",{staticClass:"group-layout",class:e.messagePosition},[e.showAvatar?s("div",{staticClass:"col-1"},[s("avatar",{staticClass:"group-member-avatar",attrs:{src:e.avatar},nativeOn:{click:function(t){return e.showGroupMemberProfile(t)}}})],1):e._e(),s("div",{staticClass:"col-2"},[e.showMessageHeader?s("message-header",{attrs:{message:e.message}}):e._e(),s("div",{staticClass:"content-wrapper"},[e.isMine?s("message-status-icon",{attrs:{message:e.message}}):e._e(),e.message.type===e.TIM.TYPES.MSG_TEXT?s("text-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_IMAGE?s("image-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FILE?s("file-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_SOUND?s("sound-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GRP_TIP?s("group-tip-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_CUSTOM?s("custom-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_FACE?s("face-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_VIDEO?s("video-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):e.message.type===e.TIM.TYPES.MSG_GEO?s("geo-element",{attrs:{isMine:e.isMine,payload:e.message.payload,message:e.message}}):s("span",[e._v("暂未支持的消息类型："+e._s(e.message.type))])],1)],1),s("div",{staticClass:"col-3"})]):e._e(),e.currentConversationType===e.TIM.TYPES.CONV_SYSTEM?s("div",{staticClass:"system-layout"},[s("div",{staticClass:"col-1"},[s("avatar",{attrs:{src:e.avatar,type:e.currentConversationType}})],1),s("div",{staticClass:"col-2"},[s("message-header",{attrs:{message:e.message}}),s("group-system-notice-element",{attrs:{payload:e.message.payload,message:e.message}})],1)]):e._e()])},T=[],S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.messageIconClass,staticStyle:{width:"16px",height:"16px"},on:{click:e.handleIconClick}},[e._v(e._s("message-send-fail"===e.messageIconClass?"!":""))])},E=[],k={name:"MessageStatusIcon",props:{message:{type:Object,required:!0}},computed:{messageIconClass(){switch(this.message.status){case"unSend":return"el-icon-loading";case"fail":return"message-send-fail";default:return""}}},methods:{handleIconClick(){"message-send-fail"===this.messageIconClass&&this.tim.resendMessage(this.message).catch(e=>{this.$store.commit("showMessage",{message:e.message,type:"error"})})}}},D=k,$=(s("a86b"),Object(y["a"])(D,S,E,!1,null,"97210bde",null)),G=$.exports,A=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"base",class:[e.isMine?"right":"left"]},[s("div",{staticClass:"name text-ellipsis"},[e._v(e._s(e.from))]),s("div",{staticClass:"date"},[e._v(e._s(e.date))])])},L=[];function R(e,t="-"){const s=e.getFullYear(),r=e.getMonth()+1,i=e.getDate();return`${s}${t}${Y(r)}${t}${Y(i)}`}function U(e,t=!1){const s=e.getHours(),r=e.getMinutes(),i=e.getSeconds();return t?`${Y(s)}:${Y(r)}:${Y(i)}`:`${s}:${Y(r)}`}function N(e){return`${R(e)} ${U(e)}`}function B(e){return e.toDateString()===(new Date).toDateString()}function Y(e){return e<10?"0"+e:e}function F(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function V(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?F(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):F(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var z={name:"MessageHeader",props:{message:{type:Object,required:!0}},computed:V(V({},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation,currentUserProfile:e=>e.user.currentUserProfile,currentMemberList:e=>e.group.currentMemberList})),{},{date(){return N(new Date(1e3*this.message.time))},from(){const e=this.currentConversation.type===this.TIM.TYPES.CONV_C2C;if(this.isMine){const t=e?void 0:this.currentConversation.groupProfile.selfInfo.nameCard;return t||this.currentUserProfile.nick||this.currentUserProfile.userID}return e?this.currentConversation.userProfile.nick||this.currentConversation.userProfile.userID:this.currentConversation.type===this.TIM.TYPES.CONV_SYSTEM?this.message.type===this.TIM.TYPES.MSG_GRP_SYS_NOTICE?"群系统通知":"系统通知":this.message.nameCard||this.message.nick||this.message.from},isMine(){return"out"===this.message.flow}})},q=z,H=(s("9122"),Object(y["a"])(q,A,L,!1,null,"39b88506",null)),J=H.exports,W=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"base",class:[e.isMine?"right":"left"]},[s("div",{staticClass:"date"},[e._v(e._s(e.date))])])},K=[];function Q(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function X(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Q(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Z={name:"MessageFooter",props:{message:{type:Object,required:!0}},computed:X(X({},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation,currentUserProfile:e=>e.user.currentUserProfile,currentMemberList:e=>e.group.currentMemberList})),{},{date(){return N(new Date(1e3*this.message.time))},from(){const e=this.currentConversation.type===this.TIM.TYPES.CONV_C2C;return this.isMine?this.currentUserProfile.nick||this.currentUserProfile.userID:e?this.currentConversation.userProfile.nick||this.currentConversation.userProfile.userID:this.message.nick||this.message.from},isMine(){return"out"===this.message.flow}})},ee=Z,te=(s("e017"),Object(y["a"])(ee,W,K,!1,null,"11baf300",null)),se=te.exports,re=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[s("div",{staticClass:"file-element-wrapper",attrs:{title:"单击下载"},on:{click:e.downloadFile}},[s("div",{staticClass:"header"},[s("i",{staticClass:"el-icon-document file-icon"}),s("div",{staticClass:"file-element"},[s("span",{staticClass:"file-name"},[e._v(e._s(e.fileName))]),s("span",{staticClass:"file-size"},[e._v(e._s(e.size))])])]),e.showProgressBar?s("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)])},ie=[],oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-bubble",on:{mousedown:function(e){e.stopPropagation()},contextmenu:function(e){e.preventDefault()}}},[e.message.isRevoked?e._e():s("el-dropdown",{ref:"dropdown",attrs:{trigger:""},on:{command:e.handleCommand}},[s("div",{staticStyle:{display:"flex"}},[e.isMine&&e.messageReadByPeer?s("div",{staticClass:"message-status"},[s("span",[e._v(e._s(e.messageReadByPeer))])]):e._e(),s("div",{staticClass:"message-content",class:e.bubbleStyle},[e._t("default")],2)]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.isMine?s("el-dropdown-item",{attrs:{command:"revoke"}},[e._v("撤回")]):e._e()],1)],1),e.message.isRevoked?s("div",{staticClass:"group-tip-element-wrapper"},[e._v("\n    "+e._s(e.text)+"\n    "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],staticClass:"edit-button",attrs:{type:"text",size:"mini"},on:{click:e.reEdit}},[e._v(" 重新编辑")])],1):e._e()],1)},ne=[],ae={name:"MessageBubble",data(){return{isTimeout:!1}},props:{isMine:{type:Boolean},isNew:{type:Boolean},message:{type:Object,required:!0}},created(){this.isTimeoutHandler()},mounted(){this.$refs.dropdown&&this.$refs.dropdown.$el&&this.$refs.dropdown.$el.addEventListener("mousedown",this.handleDropDownMousedown)},beforeDestroy(){this.$refs.dropdown&&this.$refs.dropdown.$el&&this.$refs.dropdown.$el.removeEventListener("mousedown",this.handleDropDownMousedown)},computed:{bubbleStyle(){let e="";return this.isMine?e+="message-send":e+="message-received",this.isNew&&(e+="new"),e},text(){return this.message.conversationType!==this.TIM.TYPES.CONV_C2C||this.isMine?this.message.conversationType!==this.TIM.TYPES.CONV_GROUP||this.isMine?"你撤回了一条消息":this.message.from+"撤回了一条消息":"对方撤回了一条消息"},messageReadByPeer(){return"success"===this.message.status&&(this.message.conversationType===this.TIM.TYPES.CONV_C2C&&this.message.isPeerRead?"已读":this.message.conversationType!==this.TIM.TYPES.CONV_C2C||this.message.isPeerRead?"":"未读")},isEdit(){return!!this.isMine&&(this.message.type===this.TIM.TYPES.MSG_TEXT&&!this.isTimeout)}},methods:{handleDropDownMousedown(e){this.isMine&&!this.isTimeout&&2===e.buttons&&(this.$refs.dropdown.visible?this.$refs.dropdown.hide():this.$refs.dropdown.show())},handleCommand(e){switch(e){case"revoke":this.tim.revokeMessage(this.message).then(()=>{this.isTimeoutHandler()}).catch(e=>{this.$store.commit("showMessage",{message:e,type:"warning"})});break;case"delete":break;default:break}},isTimeoutHandler(){let e=new Date;parseInt(e.getTime()/1e3)-this.message.time>120?this.isTimeout=!0:setTimeout(this.isTimeoutHandler,1e3)},reEdit(){this.$bus.$emit("reEditMessage",this.message.payload.text)}}},ce=ae,le=(s("c8ad"),Object(y["a"])(ce,oe,ne,!1,null,"5d538831",null)),ue=le.exports,pe={name:"FileElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ue,ElProgress:p["Progress"]},computed:{fileName(){return this.payload.fileName},fileUrl(){return this.payload.fileUrl},size(){const e=this.payload.fileSize;return e>1024?e/1024>1024?this.toFixed(e/1024/1024)+" Mb":this.toFixed(e/1024)+" Kb":this.toFixed(e)+"B"},showProgressBar(){return"unSend"===this.$parent.message.status},percentage(){return Math.floor(100*(this.$parent.message.progress||0))}},methods:{toFixed(e,t=2){return e.toFixed(t)},downloadFile(){if(window.fetch)fetch(this.fileUrl).then(e=>e.blob()).then(e=>{let t=document.createElement("a"),s=window.URL.createObjectURL(e);t.href=s,t.download=this.fileName,t.click()});else{let e=document.createElement("a");e.href=this.fileUrl,e.target="_blank",e.download=this.filename,e.click()}}}},me=pe,he=(s("4d06"),Object(y["a"])(me,re,ie,!1,null,"96091f5a",null)),de=he.exports,ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[s("div",{staticClass:"face-element-wrapper"},[s("img",{attrs:{src:e.url}})])])},fe=[],be={name:"FaceElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ue},computed:{url(){let e="";return e=this.payload.data.indexOf("@2x")>0?this.payload.data:this.payload.data+"@2x",`https://webim-1252463788.file.myqcloud.com/assets/face-elem/${e}.png`}}},ve=be,ye=(s("24c8"),Object(y["a"])(ve,ge,fe,!1,null,"848acce2",null)),Oe=ye.exports,Ce=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[s("img",{staticClass:"image-element",attrs:{src:e.imageUrl},on:{load:e.onImageLoaded,click:e.handlePreview}}),e.showProgressBar?s("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)},we=[];function _e(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Pe(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):_e(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var je={name:"ImageElemnt",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ue,ElProgress:p["Progress"]},computed:Pe(Pe({},Object(c["mapGetters"])(["imgUrlList"])),{},{imageUrl(){const e=this.payload.imageInfoArray[0].url;return"string"!==typeof e?"":"//"===e.slice(0,2)?"https:"+e:e},showProgressBar(){return"unSend"===this.$parent.message.status},percentage(){return Math.floor(100*(this.$parent.message.progress||0))}}),methods:{onImageLoaded(e){this.$bus.$emit("image-loaded",e)},handlePreview(){this.$bus.$emit("image-preview",{url:this.payload.imageInfoArray[0].url})}}},Me=je,Ie=(s("8810"),Object(y["a"])(Me,Ce,we,!1,null,"306e62ad",null)),xe=Ie.exports,Te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[e._l(e.contentList,(function(t,r){return["text"===t.name?s("span",{key:r,domProps:{innerHTML:e._s(e.postProcess(t.text))}}):"img"===t.name?s("img",{key:r,attrs:{src:t.src,width:"20px",height:"20px"}}):e._e()]}))],2)},Se=[];s("a481"),s("4917"),s("3b2b");function Ee(e){let t=[],s=e.text,r=-1,i=-1;while(""!==s)switch(r=s.indexOf("["),i=s.indexOf("]"),r){case 0:if(-1===i)t.push({name:"text",text:s}),s="";else{let e=s.slice(0,i+1);h[e]?(t.push({name:"img",src:m+h[e]}),s=s.substring(i+1)):(t.push({name:"text",text:"["}),s=s.slice(1))}break;case-1:t.push({name:"text",text:s}),s="";break;default:t.push({name:"text",text:s.slice(0,r)}),s=s.substring(r);break}return t}function ke(e){const t=document.createElement("div");return t.innerText=e,t.innerHTML}var De=s("ed08");const $e={"力量":"ll","体质":"tz","体型":"tx","敏捷":"mj","外貌":"wm","智力":"zl","灵感":"lg","意志":"yz","教育":"jy","理智":"lz","幸运":"xy"},Ge={"会计":"hj","人类学":"rlx","估价":"gj","考古学":"kgx","魅惑":"mh","攀爬":"pp","计算机":"jsj","信用":"xy","克苏鲁神话":"kslsh","乔装":"qz","闪避":"sb","驾驶":"js","电气维修":"dqwx","电子学":"dzx","话术":"hs","格斗":"gd","射击":"sj","急救":"jj","历史":"ls","恐吓":"kx","跳跃":"ty","母语":"my","法律":"fl","图书馆":"tsg","聆听":"lt","锁匠":"sj","机械维修":"jxwx","医学":"yx","博物学":"bwx","领航":"lh","神秘学":"sbx","重型机械":"zxjx","说服":"sf","精神分析":"jsfx","心理学":"xlx","骑术":"qs","妙手":"ms","侦查":"zc","侦察":"zc","潜行":"qx","游泳":"yy","投掷":"tz","追踪":"zz",sc:"sc",SC:"SC"},Ae={basic:{},props:{},skills:{}};function Le(e){const t=JSON.parse(JSON.stringify(Ae));t.basic={name:e["D3"].v,job:e["D5"].v,age:e["D6"].v,gender:e["L6"].v,hp:e["F10"].v,san:e["N10"].v,luck:e["V10"].v,mp:(e["AD10"]||e["AF10"]).v},t.props={"力量":e["S3"].v,"体质":e["S5"].v,"体型":e["S7"].v,"敏捷":e["Y3"].v,"外貌":e["Y5"].v,"智力":e["Y7"].v,"意志":e["AE3"].v,"教育":e["AE5"].v};const s=[19,20,21,33,34,35,36,37,38,43,44,45];for(let i=15;i<=46;i++){let r=e[(s.includes(i)?"E":"C")+i];r&&(t.skills[Re(r.v)]=e["P"+i].v)}const r=[26,30,31,32,36,40];for(let i=15;i<=40;i++){let s=e[(r.includes(i)?"Y":"W")+i];s&&(t.skills[Re(s.v)]=e["AJ"+i].v)}return t}function Re(e){switch(e){case"计算机使用 Ω":return"计算机";case"图书馆使用":return"图书馆";case"电子学 Ω":return"电子学";case"母语:":return"母语";default:return e}}const Ue=new Promise(e=>{window.XLSX?e():Object(De["a"])("https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.mini.min.js",e)}),Ne=new RegExp(`(${[...Object.keys($e),...Object.keys(Ge)].join("|")})`,"g");var Be={name:"TextElement",components:{MessageBubble:ue},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},computed:{contentList(){return Ee(this.payload)}},methods:{postProcess(e){if(this.message.conversationType===this.TIM.TYPES.CONV_GROUP){const t=this.$store.state.group.currentMemberList.filter(e=>e.userID===this.message.from);if(t.length>0&&t[0].role===this.TIM.TYPES.GRP_MBR_ROLE_OWNER){let t=e.match(/(困难|极难|极限)/);return t=t?t[0]:"",this.escape(e).replace(Ne,`<span class="underline" onclick="_onclickspan('${t}$1')">$1</span>`)}}return this.escape(e)},escape(e){return ke(e)}}};window._onclickspan=e=>{let t=document.getElementById("ghost-message-send-box");t.innerText=".d% "+e,t.click()};var Ye=Be,Fe=(s("8e6d"),s("762d"),Object(y["a"])(Ye,Te,Se,!1,null,"1d600de6",null)),Ve=Fe.exports,ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[s("div",{staticClass:"sound-element-wrapper",attrs:{title:"单击播放"},on:{click:e.play}},[s("i",{staticClass:"iconfont icon-voice"}),e._v("\n    "+e._s(e.second+'"')+"\n  ")])])},qe=[],He={name:"SoundElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ue},data(){return{amr:null}},computed:{url(){return this.payload.url},size(){return this.payload.size},second(){return this.payload.second}},methods:{play(){const e=document.createElement("audio");e.addEventListener("error",this.tryPlayAMR),e.src=this.url;const t=e.play();t&&t.catch(()=>{})},tryPlayAMR(){try{const e=/MSIE|Trident|Edge/.test(window.navigator.userAgent);if(e)return void this.$store.commit("showMessage",{message:"您的浏览器不支持该格式的语音消息播放，请尝试更换浏览器，建议使用：谷歌浏览器",type:"warning"});if(!window.BenzAMRRecorder){const e=document.createElement("script");e.addEventListener("load",this.playAMR),e.src="./BenzAMRRecorder.js";const t=document.getElementsByTagName("script")[0];return void t.parentNode.insertBefore(e,t)}this.playAMR()}catch(e){this.$store.commit("showMessage",{message:"您的浏览器不支持该格式的语音消息播放，请尝试更换浏览器，建议使用：谷歌浏览器",type:"warning"})}},playAMR(){!this.amr&&window.BenzAMRRecorder&&(this.amr=new window.BenzAMRRecorder),this.amr.isInit()?this.amr.play():this.amr.initWithUrl(this.url).then(()=>{this.amr.play()})}}},Je=He,We=(s("777c"),Object(y["a"])(Je,ze,qe,!1,null,"7ab0530b",null)),Ke=We.exports,Qe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[s("video",{staticClass:"video",attrs:{src:e.payload.videoUrl,controls:""},on:{error:e.videoError}}),e.showProgressBar?s("el-progress",{attrs:{percentage:e.percentage,color:function(e){return 100===e?"#67c23a":"#409eff"}}}):e._e()],1)},Xe=[],Ze={name:"VideoElement",components:{MessageBubble:ue,ElProgress:p["Progress"]},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},computed:{showProgressBar(){return"unSend"===this.message.status},percentage(){return Math.floor(100*(this.$parent.message.progress||0))}},methods:{videoError(e){this.$store.commit("showMessage",{type:"error",message:"视频出错，错误原因："+e.target.error.message})}}},et=Ze,tt=(s("e3ec"),Object(y["a"])(et,Qe,Xe,!1,null,"6237ab78",null)),st=tt.exports,rt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"group-tip-element-wrapper"},[e._v(e._s(e.text))])},it=[];function ot(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function nt(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ot(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var at={name:"GroupTipElement",data(){return{callTips:256}},props:{payload:{type:Object,required:!0},message:{type:Object,required:!1}},computed:nt(nt({},Object(c["mapState"])({currentUserProfile:e=>e.user.currentUserProfile,userID:e=>e.user.userID})),{},{text(){return this.getGroupTipContent(this.message)}}),methods:{getGroupTipContent(e){let t=e.nick||e.from===this.userID&&this.currentUserProfile.nick||e.from;const s=e.nick||e.payload.userIDList.join(",");switch(e.payload.operationType){case this.TIM.TYPES.GRP_TIP_MBR_JOIN:return`群成员：${s} 加入群组`;case this.TIM.TYPES.GRP_TIP_MBR_QUIT:return`群成员：${s} 退出群组`;case this.TIM.TYPES.GRP_TIP_MBR_KICKED_OUT:return`群成员：${s} 被${e.payload.operatorID}踢出群组`;case this.TIM.TYPES.GRP_TIP_MBR_SET_ADMIN:return`群成员：${s} 成为管理员`;case this.TIM.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:return`群成员：${s} 被撤销管理员`;case this.TIM.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:return"群资料修改";case this.callTips:return e.payload.text.indexOf("结束群聊")>-1?`"${e.payload.text}"`:`"${t}" ${e.payload.text}`;case this.TIM.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:for(let t of e.payload.memberList)return t.muteTime>0?`群成员：${t.userID}被禁言${t.muteTime}秒`:`群成员：${t.userID}被取消禁言`;break;default:return"[群提示消息]"}}}},ct=at,lt=(s("3763"),Object(y["a"])(ct,rt,it,!1,null,"7862d93a",null)),ut=lt.exports,pt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("message-bubble",{attrs:{isMine:!1,message:e.message}},[s("div",{staticClass:"group-system-element-wrapper"},[e._v("\n    "+e._s(e.text)+"\n    "),e.isJoinGroupRequest?s("el-button",{attrs:{type:"text"},on:{click:function(t){e.showDialog=!0}}},[e._v("处理")]):e._e(),s("el-dialog",{attrs:{title:"处理加群申请",visible:e.showDialog,width:"30%"},on:{"update:visible":function(t){e.showDialog=t}}},[s("el-form",{ref:"form",attrs:{"label-width":"100px"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[s("el-form-item",{attrs:{label:"处理结果："}},[s("el-radio-group",{model:{value:e.form.handleAction,callback:function(t){e.$set(e.form,"handleAction",t)},expression:"form.handleAction"}},[s("el-radio",{attrs:{label:"Agree"}},[e._v("同意")]),s("el-radio",{attrs:{label:"Reject"}},[e._v("拒绝")])],1)],1),s("el-form-item",{attrs:{label:"附言："}},[s("el-input",{attrs:{type:"textarea",resize:"none",rows:3,placeholder:"请输入附言"},model:{value:e.form.handleMessage,callback:function(t){e.$set(e.form,"handleMessage",t)},expression:"form.handleMessage"}})],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.handleGroupApplication}},[e._v("确 定")])],1)],1)],1)])},mt=[],ht=s("cf45"),dt={name:"GroupSystemNoticeElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!1}},components:{ElDialog:p["Dialog"],ElForm:p["Form"],ElFormItem:p["FormItem"],ElRadioGroup:p["RadioGroup"],ElRadio:p["Radio"],MessageBubble:ue},data(){return{showDialog:!1,form:{handleAction:"Agree",handleMessage:""}}},computed:{text(){return Object(ht["a"])(this.message)},title(){return this.message.type===this.TIM.TYPES.MSG_GRP_SYS_NOTICE?"群系统通知":"系统通知"},isJoinGroupRequest(){return 1===this.payload.operationType}},methods:{handleGroupApplication(){this.tim.handleGroupApplication({handleAction:this.form.handleAction,handleMessage:this.form.handleMessage,message:this.message}).then(()=>{this.showDialog=!1,this.$store.commit("removeMessage",this.message)}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message}),this.showDialog=!1})}}},gt=dt,ft=(s("4011"),Object(y["a"])(gt,pt,mt,!1,null,"8a49ee1a",null)),bt=ft.exports,vt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"group-tip-element-wrapper"},[e._v(e._s(e.text))])},yt=[];function Ot(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Ct(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ot(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var wt={name:"CustomElement",props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},components:{MessageBubble:ue},computed:Ct(Ct({},Object(c["mapState"])({currentUserProfile:e=>e.user.currentUserProfile})),{},{text(){return this.translateCustomMessage(this.payload)}}),methods:{translateCustomMessage(e){return e.description}}},_t=wt,Pt=(s("ec25"),Object(y["a"])(_t,vt,yt,!1,null,"3a2bf9c9",null)),jt=Pt.exports,Mt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("message-bubble",{attrs:{isMine:e.isMine,message:e.message}},[s("a",{staticClass:"geo-element",attrs:{href:e.href,target:"_blank",title:"点击查看详情"}},[s("span",{staticClass:"el-icon-location-outline"},[e._v(e._s(e.payload.description))]),s("img",{attrs:{src:e.url}})])])},It=[],xt={name:"GeoElement",components:{MessageBubble:ue},props:{payload:{type:Object,required:!0},message:{type:Object,required:!0},isMine:{type:Boolean}},data(){return{url:""}},computed:{lon(){return this.payload.longitude.toFixed(6)},lat(){return this.payload.latitude.toFixed(6)},href(){return`https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx=${this.lon}&pointy=${this.lat}&name=${this.payload.description}`}},mounted(){this.url=`https://apis.map.qq.com/ws/staticmap/v2/?center=${this.lat},${this.lon}&zoom=10&size=300*150&maptype=roadmap&markers=size:large|color:0xFFCCFF|label:k|${this.lat},${this.lon}&key=UBNBZ-PTP3P-TE7DB-LHRTI-Y4YLE-VWBBD`}},Tt=xt,St=(s("daca"),Object(y["a"])(Tt,Mt,It,!1,null,"58085edc",null)),Et=St.exports;function kt(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Dt(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):kt(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var $t={name:"MessageItem",props:{message:{type:Object,required:!0}},components:{MessageHeader:J,MessageFooter:se,MessageStatusIcon:G,FileElement:de,FaceElement:Oe,ImageElement:xe,TextElement:Ve,SoundElement:Ke,GroupTipElement:ut,GroupSystemNoticeElement:bt,CustomElement:jt,VideoElement:st,GeoElement:Et},data(){return{renderDom:[]}},computed:Dt(Dt({},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation,currentUserProfile:e=>e.user.currentUserProfile})),{},{showAvatar(){return"C2C"===this.currentConversation.type&&!this.message.isRevoked||"GROUP"===this.currentConversation.type&&!this.message.isRevoked&&(this.message.type!==this.TIM.TYPES.MSG_GRP_TIP&&this.message.type!==this.TIM.TYPES.MSG_CUSTOM)},avatar(){return"C2C"===this.currentConversation.type?this.isMine?this.currentUserProfile.avatar:this.currentConversation.userProfile.avatar:"GROUP"===this.currentConversation.type?this.isMine?this.currentUserProfile.avatar:this.message.avatar:""},currentConversationType(){return this.currentConversation.type},isMine(){return"out"===this.message.flow},messagePosition(){return["TIMGroupTipElem","TIMGroupSystemNoticeElem",this.TIM.TYPES.MSG_CUSTOM].includes(this.message.type)||this.message.isRevoked?"position-center":this.isMine?"position-right":"position-left"},showMessageHeader(){return!["TIMGroupTipElem","TIMGroupSystemNoticeElem",this.TIM.TYPES.MSG_CUSTOM].includes(this.message.type)&&!this.message.isRevoked}}),methods:{showGroupMemberProfile(e){this.tim.getGroupMemberProfile({groupID:this.message.to,userIDList:[this.message.from]}).then(({data:{memberList:t}})=>{t[0]&&this.$bus.$emit("showMemberProfile",{event:e,member:t[0]})})}}},Gt=$t,At=(s("8674"),Object(y["a"])(Gt,x,T,!1,null,"14ff1cbc",null)),Lt=At.exports,Rt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"conversation-profile-wrapper"},[e.currentConversation.type===e.TIM.TYPES.CONV_C2C?s("user-profile",{attrs:{userProfile:e.currentConversation.userProfile}}):e._e()],1)},Ut=[],Nt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"profile-user"},[s("avatar",{attrs:{title:e.userProfile.userID,src:e.userProfile.avatar}}),s("div",{staticClass:"nick-name text-ellipsis"},[e.userProfile.nick?s("span",{attrs:{title:e.userProfile.nick}},[e._v("\n      "+e._s(e.userProfile.nick)+"\n    ")]):s("span",{staticClass:"anonymous",attrs:{title:"该用户未设置昵称"}},[e._v("\n      [Anonymous]\n    ")])]),e.genderClass?s("div",{staticClass:"gender"},[s("span",{staticClass:"iconfont",class:e.genderClass,attrs:{title:e.gender}})]):e._e(),e.isInBlacklist||e.userProfile.userID===e.myUserID?e.isInBlacklist?s("el-button",{attrs:{title:"将该用户移出黑名单",type:"text"},on:{click:e.removeFromBlacklist}},[e._v("移出黑名单")]):e._e():s("el-button",{staticClass:"btn-add-blacklist",attrs:{title:"将该用户加入黑名单",type:"text"},on:{click:e.addToBlackList}},[e._v("加入黑名单")])],1)},Bt=[];function Yt(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Ft(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Yt(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Vt={props:{userProfile:{type:Object,required:!0}},computed:Ft(Ft({},Object(c["mapState"])({blacklist:e=>e.blacklist.blacklist,myUserID:e=>e.user.currentUserProfile.userID})),{},{isInBlacklist(){return this.blacklist.findIndex(e=>e.userID===this.userProfile.userID)>=0},gender(){switch(this.userProfile.gender){case this.TIM.TYPES.GENDER_MALE:return"男";case this.TIM.TYPES.GENDER_FEMALE:return"女";default:return"未设置"}},genderClass(){switch(this.userProfile.gender){case this.TIM.TYPES.GENDER_MALE:return"icon-male";case this.TIM.TYPES.GENDER_FEMALE:return"icon-female";default:return""}}}),methods:{addToBlackList(){this.tim.addToBlacklist({userIDList:[this.userProfile.userID]}).then(()=>{this.$store.dispatch("getBlacklist")}).catch(e=>{this.$store.commit("showMessage",{message:e.message,type:"error"})})},removeFromBlacklist(){this.tim.removeFromBlacklist({userIDList:[this.userProfile.userID]}).then(()=>{this.$store.commit("removeFromBlacklist",this.userProfile.userID)}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})}}},zt=Vt,qt=(s("873f"),Object(y["a"])(zt,Nt,Bt,!1,null,"f157254a",null)),Ht=qt.exports;function Jt(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Wt(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Jt(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Kt={name:"ConversationProfile",components:{UserProfile:Ht},data(){return{}},computed:Wt({},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation}))},Qt=Kt,Xt=(s("a672"),Object(y["a"])(Qt,Rt,Ut,!1,null,"59510297",null)),Zt=Xt.exports,es=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",{attrs:{name:"el-fade-in"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],ref:"member-profile-card",staticClass:"member-profile-card-wrapper",style:{top:e.y+"px",left:e.x+"px"}},[s("div",{staticClass:"profile"},[s("avatar",{staticClass:"avatar",attrs:{src:e.member.avatar}}),s("div",{staticClass:"basic"},[s("span",[e._v("ID："+e._s(e.member.userID))]),s("span",[e._v("昵称："+e._s(e.member.nick||"暂无"))])])],1),s("el-divider",{staticClass:"divider"}),s("div",{staticClass:"member-profile"},[s("div",{staticClass:"item"},[s("span",{staticClass:"label"},[e._v("群名片")]),e._v("\n        "+e._s(e.member.nameCard||"暂无")+"\n      ")]),s("div",{staticClass:"item"},[s("span",{staticClass:"label"},[e._v("入群时间")]),e._v("\n        "+e._s(e.joinTime)+"\n      ")]),e.member.muteUntil?s("div",{staticClass:"item"},[s("span",{staticClass:"label"},[e._v("禁言至")]),e._v("\n        "+e._s(e.muteUntil)+"\n      ")]):e._e()]),s("el-button",{staticClass:"send-message-btn",attrs:{type:"primary",size:"mini",title:"发消息",icon:"el-icon-message",circle:""},on:{click:e.handleSendMessage}})],1)])},ts=[],ss={name:"MemberProfileCard",components:{ElDivider:p["Divider"]},data(){return{member:{},x:0,y:0,visible:!1}},mounted(){this.$bus.$on("showMemberProfile",this.handleShowMemberProfile,this)},computed:{joinTime(){return this.member.joinTime?N(new Date(1e3*this.member.joinTime)):""},muteUntil(){return this.member.muteUntil?N(new Date(1e3*this.member.muteUntil)):""}},methods:{handleSendMessage(){this.$store.dispatch("checkoutConversation","C2C"+this.member.userID),this.hide()},handleShowMemberProfile({event:e,member:t}){this.member=t||{},this.x=e.x,this.y=e.y,this.show()},show(){this.visible||(window.addEventListener("click",this.handleClick,this),this.visible=!0)},hide(){this.visible&&(window.removeEventListener("click",this.handleClick,this),this.visible=!1)},handleClick(e){e.target!==this.$refs["member-profile-card"]&&this.hide()}}},rs=ss,is=(s("29bd"),Object(y["a"])(rs,es,ts,!1,null,"1012cb30",null)),os=is.exports,ns=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-tabs",{staticClass:"group-right-panels background-blur",attrs:{value:e.currentGame.currentTab,type:"card"},on:{input:function(t){return e.$store.commit("setCurrentTab",{groupId:e.currentConversation.groupProfile.groupID,tab:t})},"tab-click":e.handleClick,"tab-remove":e.handleRemove}},[e._l(e.allTabs,(function(t){return["group"===t?s("el-tab-pane",{key:t,attrs:{label:"群信息",name:t}},[s("group-profile",{key:e.currentConversation.groupProfile.groupID,attrs:{"group-profile":e.currentConversation.groupProfile}})],1):"note"===t?s("el-tab-pane",{key:t,attrs:{name:t}},[s("el-badge",{attrs:{slot:"label","is-dot":"",hidden:!e.currentGame.noteUnread},slot:"label"},[e._v("重要笔记")]),s("note-panel",{attrs:{"group-profile":e.currentConversation.groupProfile}})],1):"log"===t?s("el-tab-pane",{key:t,attrs:{label:"Log 录制",name:t}},[s("log-panel",{attrs:{"group-profile":e.currentConversation.groupProfile}})],1):s("el-tab-pane",{key:t,attrs:{label:e.getCardName(t),name:t,closable:!0}},[s("card-panel",{attrs:{member:t}})],1)]}))],2)},as=[],cs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("group-member-list",{attrs:{groupProfile:e.groupProfile}}),s("div",{staticClass:"group-info-content"},[s("div",{staticClass:"info-item"},[s("div",{staticClass:"label"},[e._v("\n          群头像\n          "),e.editable?s("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer","font-size":"14px"},on:{click:function(t){e.showEditFaceUrl=!0}}}):e._e()]),s("div",{staticClass:"content"},[s("avatar",{attrs:{src:e.displayAvatar}})],1),s("el-dialog",{attrs:{title:"设置群头像",visible:e.showEditFaceUrl,width:"40%","append-to-body":""},on:{"update:visible":function(t){e.showEditFaceUrl=t}}},[s("image-upload",{model:{value:e.avatar,callback:function(t){e.avatar=t},expression:"avatar"}}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showEditFaceUrl=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary",disabled:0===e.avatar.trim().length},on:{click:e.editFaceUrl}},[e._v("确 定")])],1)],1)],1),s("div",{staticClass:"info-item"},[s("div",{staticClass:"label"},[e._v("\n          群名称\n          "),e.editable?s("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer","font-size":"14px"},on:{click:function(t){e.showEditName=!0,e.inputFocus("editName")}}}):e._e()]),e.showEditName?s("el-input",{ref:"editName",staticStyle:{width:"60%"},attrs:{autofocus:"",size:"mini"},on:{blur:function(t){e.showEditName=!1}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.editName(t)}},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}):s("div",{staticClass:"content text-ellipsis",attrs:{title:e.groupProfile.name}},[e._v("\n          "+e._s(e.groupProfile.name||"暂无")+"\n        ")])],1),s("div",{staticClass:"info-item"},[s("div",{staticClass:"label"},[e._v("\n          群消息提示类型\n          "),e.editable?s("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer","font-size":"14px"},on:{click:function(t){e.showEditMessageRemindType=!0,e.inputFocus("editMessageRemindType")}}}):e._e()]),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.showEditMessageRemindType,expression:"!showEditMessageRemindType"}],staticClass:"content"},[e._v("\n          "+e._s(e.messageRemindTypeMap[this.groupProfile.selfInfo.messageRemindType])+"\n        ")]),s("el-select",{directives:[{name:"show",rawName:"v-show",value:e.showEditMessageRemindType,expression:"showEditMessageRemindType"}],ref:"editMessageRemindType",attrs:{size:"mini","automatic-dropdown":""},on:{change:e.editMessageRemindType,blur:function(t){e.showEditMessageRemindType=!1}},model:{value:e.messageRemindType,callback:function(t){e.messageRemindType=t},expression:"messageRemindType"}},[s("el-option",{attrs:{label:"接收消息并提示",value:"AcceptAndNotify"}}),s("el-option",{attrs:{label:"接收消息但不提示",value:"AcceptNotNotify"}}),s("el-option",{attrs:{label:"屏蔽消息",value:"Discard"}})],1)],1),s("div",{staticClass:"info-item"},[s("div",{staticClass:"label"},[e._v("\n          我的群名片\n          "),s("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer","font-size":"14px"},on:{click:function(t){e.showEditNameCard=!0,e.inputFocus("editNameCard")}}})]),e.showEditNameCard?s("el-input",{ref:"editNameCard",staticStyle:{width:"60%"},attrs:{autofocus:"",size:"mini"},on:{blur:function(t){e.showEditNameCard=!1}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.editNameCard(t)}},model:{value:e.nameCard,callback:function(t){e.nameCard=t},expression:"nameCard"}}):s("div",{staticClass:"content cursor-pointer"},[e._v("\n          "+e._s(e.groupProfile.selfInfo.nameCard||"暂无")+"\n        ")])],1),e.isOwner?s("div",{staticClass:"info-item"},[s("div",{staticClass:"label"},[e._v("全体禁言")]),s("el-switch",{on:{change:e.changeMuteStatus},model:{value:e.muteAllMembers,callback:function(t){e.muteAllMembers=t},expression:"muteAllMembers"}})],1):e._e(),e.isOwner?s("div",{staticClass:"info-item"},[s("div",{staticClass:"label"},[e._v("启用机器人")]),s("bot-switch")],1):e._e(),s("div",{staticClass:"info-item"},[s("div",{staticClass:"label"},[e._v("\n          群公告\n          "),e.editable?s("i",{staticClass:"el-icon-edit",staticStyle:{cursor:"pointer","font-size":"14px"},on:{click:function(t){e.showEditNotification=!0,e.inputFocus("editNotification")}}}):e._e()]),e.showEditNotification?s("el-input",{ref:"editNotification",staticStyle:{width:"60%"},attrs:{autofocus:"",size:"mini"},on:{blur:function(t){e.showEditNotification=!1}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.editNotification(t)}},model:{value:e.notification,callback:function(t){e.notification=t},expression:"notification"}}):s("div",{staticClass:"long-content",attrs:{title:e.groupProfile.notification}},[e._v("\n          "+e._s(e.groupProfile.notification||"暂无")+"\n        ")])],1)]),s("div",{staticClass:"action-btns"},[e.isOwner?s("kp-actions"):e._e(),s("div",[s("div",[s("el-button",{attrs:{type:"text"},on:{click:e.quitGroup}},[e._v("退出群组")])],1),e.showDissmissGroup?s("div",[s("el-button",{attrs:{type:"text"},on:{click:e.dismissGroup}},[e._v("解散群组")])],1):e._e()])],1)],1)},ls=[],us=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"group-member-list-wrapper"},[s("div",{staticClass:"header"},[s("span",{staticClass:"member-count text-ellipsis"},[e._v("群成员："+e._s(e.members.length))]),s("i",{staticClass:"el-icon-link",attrs:{title:"复制邀请链接"},on:{click:function(t){e.inviteDialogShow=!0}}}),s("i",{staticClass:"el-icon-refresh",attrs:{title:"刷新群成员信息"},on:{click:e.refreshGroupMember}})]),s("div",{staticClass:"scroll-content"},[s("div",{staticClass:"group-member-list"},e._l(e.members,(function(t){return s("div",{key:t.userID},[s("div",{staticClass:"group-member",attrs:{slot:"reference"},slot:"reference"},[s("div",{staticClass:"info"},[s("avatar",{attrs:{title:e.getGroupMemberAvatarText(t.role),src:t.avatar}}),s("div",{staticClass:"names"},[s("div",{staticClass:"member-name text-ellipsis"},[e._v(e._s(e.getShowUserNick(t)))]),s("div",{staticClass:"member-id"},[e._v(e._s(e.getShowUserId(t)))])])],1),s("div",{staticClass:"actions"},[t.userID.startsWith("bot")?e._e():s("el-button",{staticClass:"action-btn",attrs:{title:"查看人物卡",icon:"el-icon-tickets",size:"mini",circle:""},on:{click:function(s){return e.openUserCard(t.userID)}}}),e.isOwner?s("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleDropdownCommand}},[s("el-button",{staticClass:"action-btn",attrs:{title:"更多操作",icon:"el-icon-more",size:"mini",circle:""}}),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.userID.startsWith("bot")?e._e():s("el-dropdown-item",{attrs:{icon:"el-icon-circle-plus-outline",command:"ImportCard:"+t.userID}},[e._v("\n                      导入人物卡\n                    ")]),e.isBotOfThisGroup(t)?s("el-dropdown-item",{attrs:{icon:"el-icon-picture-outline",command:"SetAvatar:"+t.userID}},[e._v("\n                      修改头像\n                    ")]):e._e(),s("el-dropdown-item",{attrs:{icon:"el-icon-edit",command:"SetNick:"+t.userID}},[e._v("\n                      修改群名片\n                    ")]),"Owner"!==t.role?s("el-dropdown-item",{staticStyle:{color:"#F56C6C"},attrs:{icon:"el-icon-delete",command:"Kick:"+t.userID}},[e._v("\n                      踢出群聊\n                    ")]):e._e()],1)],1):e._e()],1)])])})),0)]),e.isOwner?s("card-import",{attrs:{visible:!!e.importCardMemberID,"group-id":e.groupProfile.groupID,"member-id":e.importCardMemberID},on:{"update:visible":function(t){e.importCardMemberID=null}}}):e._e(),s("el-dialog",{attrs:{title:"邀请入群",visible:e.inviteDialogShow,width:"40%","append-to-body":""},on:{"update:visible":function(t){e.inviteDialogShow=t}}},[s("div",{staticClass:"invite-dialog"},[s("div",[s("h3",[e._v("分享给网页")]),s("el-button",{attrs:{type:"primary"},on:{click:e.copyInviteLink}},[e._v("复制邀请链接")]),s("div",{staticClass:"desc"},[e._v("复制后发给小伙伴，小伙伴点击链接在新窗口中打开，登录后即可自动进群")])],1),s("div",[s("h3",[e._v("分享给小程序")]),s("img",{attrs:{src:e.minacode}}),s("img",{attrs:{src:e.getInviteQRCodeUrl()}}),s("div",{staticClass:"desc"},[e._v("①微信扫描左边二维码打开【跑团IO】小程序"),s("br"),e._v("②在小程序登录页面扫描右边二维码，自动填充信息"),s("br"),e._v("③输入自己的QQ后登录即可自动进群")])])])])],1)},ps=[],ms=(s("28a5"),s("41a3")),hs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.member?s("el-dialog",{attrs:{title:"导入人物卡(beta)",visible:e.visible,width:"40%","append-to-body":""},on:{close:e.onClose,"update:visible":function(t){return e.$emit("update:visible",t)}}},[s("input",{ref:"chooser",attrs:{type:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",value:"选择文件"},on:{change:e.handleFile}}),s("div",[e._v("当前支持的人物卡模版：COC七版人物卡v1.6.0   "),s("el-link",{attrs:{type:"primary",underline:!1,href:"/static/cocv7.xlsx"}},[e._v("点击下载")])],1),s("h3",[e._v(e._s("为玩家 "+(e.member.nameCard||e.member.nick||e.member.userID)+" 导入人物卡"))]),e.existedCard?s("el-alert",{attrs:{title:"该玩家已有人物卡，再次导入将覆盖之前的人物卡",type:"warning","show-icon":"",closable:!1}}):e._e(),e.user?s("div",{staticClass:"card-data"},[s("h3",[e._v("基本信息")]),s("div",[e._v(e._s(e.user.basic.name+" "+e.user.basic.gender+" "+e.user.basic.age+"岁 "+e.user.basic.job))]),s("div",[e._v(e._s("体力 "+e.user.basic.hp+" | 理智 "+e.user.basic.san+" | 幸运 "+e.user.basic.luck+" | 魔法 "+e.user.basic.mp))]),s("h3",[e._v("属性")]),s("div",{staticClass:"user-prop"},e._l(e.user.props,(function(t,r){return s("div",{key:r},[e._v("\n          "+e._s(r+": "+t)+"\n        ")])})),0),s("h3",[e._v("技能")]),s("div",{staticClass:"user-skill"},e._l(e.user.skills,(function(t,r){return s("div",{key:r},[e._v("\n          "+e._s(r+": "+t)+"\n        ")])})),0)]):e._e(),e.user?s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:e.onConfirm}},[e._v("确定导入")])],1):e._e()],1):e._e()],1)},ds=[];function gs(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function fs(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?gs(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):gs(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var bs={props:["groupId","memberId","visible"],data(){return{user:null}},computed:fs(fs({},Object(c["mapState"])({existedCard:function(e){return e.game.list[this.groupId]?e.game.list[this.groupId].cards["o"+this.memberId]:null},currentMemberList:e=>e.group.currentMemberList})),{},{member(){return this.memberId?this.currentMemberList.find(e=>e.userID===this.memberId):null}}),methods:{handleFile(e){const t=e.target.files,s=t[0],r=new FileReader;r.onload=e=>{Ue.then(()=>{try{const t=new Uint8Array(e.target.result),s=window.XLSX.read(t,{type:"array"}),r=s.Sheets[s.SheetNames[0]];this.user=Le(r)}catch(e){console.log(e),this.$store.commit("showMessage",{type:"error",message:"导入失败，可能是格式不正确或字段缺失"})}})},r.readAsArrayBuffer(s)},onConfirm(){this.$store.commit("setUserCard",{groupId:this.groupId,userId:this.member.userID,card:this.user});const e=this.tim.createCustomMessage({to:this.groupId,conversationType:this.TIM.TYPES.CONV_GROUP,priority:this.TIM.TYPES.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify({mtype:"card",mdata:{userId:this.member.userID,card:this.user}}),description:`主持人为玩家“${this.member.nameCard||this.member.nick||this.member.userID}”导入了一张人物卡`}});this.$store.commit("pushCurrentMessageList",e),this.tim.sendMessage(e).then(()=>{this.$store.commit("showMessage",{type:"success",message:"导入成功"})}).catch(()=>{this.$store.commit("showMessage",{type:"error",message:"导入成功，但同步给其他群成员失败，可以重试"})}),this.$emit("update:visible",!1)},onClose(){this.$refs.chooser.value="",this.user=null}}},vs=bs,ys=(s("195f"),Object(y["a"])(vs,hs,ds,!1,null,"0c4cf41f",null)),Os=ys.exports,Cs=s("0304"),ws=s.n(Cs);function _s(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Ps(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?_s(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):_s(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var js={data(){return{addGroupMemberVisible:!1,count:30,inviteDialogShow:!1,minacode:ws.a,importCardMemberID:null}},props:["groupProfile"],components:{CardImport:Os},computed:Ps(Ps({},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation,currentMemberList:e=>e.group.currentMemberList})),{},{showLoadMore(){return this.members.length<this.groupProfile.memberCount},members(){return this.currentMemberList},isOwner(){return this.groupProfile.selfInfo.role===this.TIM.TYPES.GRP_MBR_ROLE_OWNER}}),methods:{getGroupMemberAvatarText(e){switch(e){case"Owner":return"群主";case"Admin":return"管理员";default:return"群成员"}},getShowUserNick(e){return e.nameCard||e.nick||e.userID},getShowUserId(e){return e.userID.startsWith("bot")?"机器人":e.nameCard||e.nick?e.userID:""},isBotOfThisGroup(e){return this.groupProfile.groupID.replace("@TGS#","bot_")===e.userID},getInviteQRCodeUrl(){const e=`${Object(ms["d"])()}/${this.groupProfile.groupID.replace("@TGS#","")}`;return"https://api.pwmqr.com/qrcode/create/?url="+e},copyInviteLink(){this.$copyText(`${location.origin}/#/?s=${Object(ms["d"])()}&g=${this.groupProfile.groupID.replace("@TGS#","")}&d=\n点击链接加入群聊一起玩~`).then(()=>{this.$store.commit("showMessage",{type:"success",message:"邀请链接复制成功！快发给小伙伴们一起玩吧~"})}).catch(e=>{console.log("copy link error",e),this.$store.commit("showMessage",{type:"error",message:"邀请链接复制失败"})})},refreshGroupMember(){this.$store.dispatch("getGroupMemberList",this.currentConversation.groupProfile.groupID).then(()=>{this.$store.commit("showMessage",{type:"success",message:"刷新成功"})})},setBotAvatar(e){Object(ms["h"])(this.currentConversation.groupProfile.groupID,e).then(()=>{this.$store.commit("showMessage",{message:"修改成功"})}).catch(e=>{console.log(e),this.$store.commit("showMessage",{type:"error",message:"修改头像失败，请检查是否启用机器人，未启用状态不能修改"})})},setGroupMemberNameCard(e,t){this.tim.setGroupMemberNameCard({groupID:this.currentConversation.groupProfile.groupID,userID:e,nameCard:t}).then(()=>{this.$store.commit("showMessage",{message:"修改成功"})}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},kickoutGroupMember(e){this.tim.deleteGroupMember({groupID:this.currentConversation.groupProfile.groupID,reason:"被群主踢出",userIDList:[e]}).then(()=>{this.$store.commit("deleteGroupMemeber",e)}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},openUserCard(e){this.$store.dispatch("openUserCard",{groupId:this.currentConversation.groupProfile.groupID,userId:e}).catch(()=>{this.$store.commit("showMessage",{type:"warning",message:"该成员尚未导入人物卡"})})},handleDropdownCommand(e){const[t,s]=e.split(":");switch(t){case"ImportCard":this.importCardMemberID=s;break;case"SetAvatar":this.$prompt("请输入头像 URL","修改机器人头像",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"头像 URL"}).then(({value:e})=>{this.setBotAvatar(e)}).catch(()=>{});break;case"SetNick":this.$prompt("请输入群名片","修改群名片",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"群名片"}).then(({value:e})=>{this.setGroupMemberNameCard(s,e)}).catch(()=>{});break;case"Kick":{const e=this.members.find(e=>e.userID===s);this.$confirm(`将${this.getShowUserNick(e)}踢出群组？`,"踢出群聊",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.kickoutGroupMember(s)}).catch(()=>{});break}}}}},Ms=js,Is=(s("2415"),Object(y["a"])(Ms,us,ps,!1,null,"38b7620b",null)),xs=Is.exports,Ts=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",[s("el-button",{attrs:{type:"text"},on:{click:function(t){e.sendBgmVisible=!0}}},[e._v("设置游戏 BGM")])],1),s("div",[s("el-button",{attrs:{type:"text"},on:{click:function(t){e.setSceneVisible=!0}}},[e._v("设置游戏场景")])],1),s("div",[s("el-button",{attrs:{type:"text"},on:{click:function(t){e.sendTextVisible=!0}}},[e._v("发布文字笔记")])],1),s("div",[s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.$refs.noteImgPicker.click()}}},[e._v("发布图片笔记")])],1),s("input",{ref:"noteImgPicker",staticStyle:{display:"none"},attrs:{type:"file",id:"noteImgPicker",accept:".jpg, .jpeg, .png, .gif, .bmp"},on:{change:e.sendNoteImage}}),s("el-dialog",{attrs:{title:"🎵 设置 BGM",visible:e.sendBgmVisible,width:"40%","append-to-body":""},on:{"update:visible":function(t){e.sendBgmVisible=t}}},[s("div",{staticClass:"dialog-content"},[s("div",[e._v("设置 BGM，BGM 将对全部群员可见。如多次设置，则会覆盖之前设置的 BGM。")]),s("div",[e._v("BGM 链接需符合指定的格式。")]),s("ul",[s("li",[e._v("网易云音乐\n          "),s("ul",[s("li",[e._v("歌单："),s("span",{staticClass:"code"},[e._v("https://music.163.com/#/playlist?id=xxxxxxx")])]),s("li",[e._v("单曲："),s("span",{staticClass:"code"},[e._v("https://music.163.com/#/song?id=xxxxxxx")])]),s("li",[e._v("专辑："),s("span",{staticClass:"code"},[e._v("https://music.163.com/#/album?id=xxxxxxx")])])])])])]),s("el-input",{attrs:{placeholder:"请输入音乐链接"},model:{value:e.bgmLink,callback:function(t){e.bgmLink=t},expression:"bgmLink"}}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.sendBgmVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary",disabled:0===e.bgmLink.trim().length},on:{click:e.setBgm}},[e._v("确 定")])],1)],1),s("el-dialog",{attrs:{title:"🎬 设置游戏场景",visible:e.setSceneVisible,width:"40%","append-to-body":""},on:{"update:visible":function(t){e.setSceneVisible=t}}},[s("div",{staticClass:"dialog-content"},[s("div",[e._v("游戏场景图片"),s("span",{staticClass:"tip"},[e._v("场景图片将作为整个界面的背景图")])]),s("image-upload",{model:{value:e.sceneUrl,callback:function(t){e.sceneUrl=t},expression:"sceneUrl"}}),s("div",[e._v("场景切换提示"),s("span",{staticClass:"tip"},[e._v("场景切换提示将显示为小灰条消息")])]),s("el-input",{staticStyle:{margin:"0 10px","padding-right":"20px"},attrs:{type:"textarea",placeholder:"主持人切换了游戏场景"},model:{value:e.sceneTip,callback:function(t){e.sceneTip=t},expression:"sceneTip"}})],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.setSceneVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.setScene}},[e._v("确 定")])],1)]),s("el-dialog",{attrs:{title:"发布文字笔记",visible:e.sendTextVisible,width:"40%","append-to-body":""},on:{"update:visible":function(t){e.sendTextVisible=t}}},[s("el-input",{attrs:{type:"textarea",rows:5,placeholder:"请输入内容"},model:{value:e.textContent,callback:function(t){e.textContent=t},expression:"textContent"}}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.sendTextVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary",disabled:0===e.textContent.trim().length},on:{click:e.sendNoteText}},[e._v("确 定")])],1)],1)],1)},Ss=[],Es=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"flex"}},[s("el-input",{attrs:{value:e.value,placeholder:"请输入图片 URL，或点击右侧按钮上传本地图片"},on:{input:function(t){return e.$emit("input",t)}}}),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{loading:e.loading,icon:"el-icon-upload"},on:{click:function(t){return e.$refs.imgPicker.click()}}}),s("input",{ref:"imgPicker",staticStyle:{display:"none"},attrs:{type:"file",accept:".jpg, .jpeg, .png, .gif, .bmp"},on:{change:e.uploadImage}})],1)},ks=[],Ds={name:"ImageUpload",props:{value:{type:String,required:!0}},data(){return{loading:!1}},methods:{async uploadImage(){const e=this.$refs.imgPicker;if(!e.value)return;this.loading=!0;const t=this.tim.createImageMessage({to:this.$store.state.user.userID,conversationType:this.TIM.TYPES.CONV_C2C,priority:this.TIM.TYPES.MSG_PRIORITY_HIGH,payload:{file:e}});try{await this.tim.sendMessage(t);const e=t.payload.imageInfoArray[0].imageUrl;this.$emit("input",e)}catch(s){this.$store.commit("showMessage",{type:"error",message:s.message})}finally{this.loading=!1}}}},$s=Ds,Gs=Object(y["a"])($s,Es,ks,!1,null,null,null),As=Gs.exports;function Ls(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Rs(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ls(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ls(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Us={components:{ImageUpload:As},data(){const e=this.$store.state.game.list[this.$store.state.conversation.currentConversation.groupProfile.groupID];return{sendBgmVisible:!1,bgmLink:"",sendTextVisible:!1,textContent:"",setSceneVisible:!1,sceneUrl:e.scene,sceneTip:""}},computed:Rs({},Object(c["mapState"])({groupProfile:e=>e.conversation.currentConversation.groupProfile,currentGame:e=>e.game.list[e.conversation.currentConversation.groupProfile.groupID]})),methods:{setBgm(){const e=this.bgmLink.match(/https:\/\/music\.163\.com\/#\/(playlist|song|album)\?id=(\d+)/);if(!e)return void this.$store.commit("showMessage",{type:"error",message:"链接格式不正确"});const t={platform:1,type:["playlist","album","song"].indexOf(e[1]),id:Number(e[2])},s=this.tim.createCustomMessage({to:this.groupProfile.groupID,conversationType:this.TIM.TYPES.CONV_GROUP,priority:this.TIM.TYPES.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify({mtype:"bgm",mdata:t}),description:"主持人设置了新的 BGM，快点击右侧【重要笔记】面板查看吧"}});this._sendNoteMessage(s),this.bgmLink="",this.sendBgmVisible=!1},setScene(){const e=this.sceneTip.trim(),t=this.tim.createCustomMessage({to:this.groupProfile.groupID,conversationType:this.TIM.TYPES.CONV_GROUP,priority:this.TIM.TYPES.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify({mtype:"scene",mdata:this.sceneUrl}),description:e.length>0?e:"主持人切换了游戏场景"}});this._sendNoteMessage(t),this.setSceneVisible=!1},sendNoteText(){const e=this.tim.createTextMessage({to:this.groupProfile.groupID,conversationType:this.TIM.TYPES.CONV_GROUP,priority:this.TIM.TYPES.MSG_PRIORITY_HIGH,payload:{text:this.textContent}});this._sendNoteMessage(e),this._sendGrayTipMessage("主持人发布了一条新的笔记，快点击右侧【重要笔记】面板查看吧"),this.textContent="",this.sendTextVisible=!1},sendNoteImage(){const e=this.tim.createImageMessage({to:this.groupProfile.groupID,conversationType:this.TIM.TYPES.CONV_GROUP,priority:this.TIM.TYPES.MSG_PRIORITY_HIGH,payload:{file:document.getElementById("noteImgPicker")}});this._sendNoteMessage(e),this._sendGrayTipMessage("主持人发布了一条新的笔记，快点击右侧【重要笔记】面板查看吧"),this.$refs.noteImgPicker.value=null},_sendNoteMessage(e){this.$store.commit("pushCurrentMessageList",e),this.tim.sendMessage(e).then(()=>{this.$store.dispatch("handleKPNote",[e])}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},_sendGrayTipMessage(e){const t=this.tim.createCustomMessage({to:this.groupProfile.groupID,conversationType:this.TIM.TYPES.CONV_GROUP,payload:{data:JSON.stringify({mtype:"tip"}),description:e}});this.$store.commit("pushCurrentMessageList",t),this.tim.sendMessage(t)}}},Ns=Us,Bs=(s("4ce1"),Object(y["a"])(Ns,Ts,Ss,!1,null,"35879eb6",null)),Ys=Bs.exports,Fs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-switch",{attrs:{value:e.currentGame.botEnabled,disabled:e.botSwitchLoading},on:{change:e.onBotSwitch}})},Vs=[],zs=s("daa3");function qs(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Hs(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?qs(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):qs(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Js={data(){return{botSwitchLoading:!1}},computed:Hs({},Object(c["mapState"])({groupID:e=>e.conversation.currentConversation.groupProfile.groupID,currentGame:e=>e.game.list[e.conversation.currentConversation.groupProfile.groupID]})),methods:{async onBotSwitch(e){this.botSwitchLoading=!0;try{await Object(zs["b"])(),await this.$store.dispatch("toggleBotEnabled",{groupId:this.groupID,enabled:e})}catch(t){this.$store.commit("showMessage",{type:"error",message:"切换机器人失败，请联系管理员"}),console.log("切换 bot 失败",t)}finally{this.botSwitchLoading=!1}}}},Ws=Js,Ks=Object(y["a"])(Ws,Fs,Vs,!1,null,null,null),Qs=Ks.exports,Xs={props:["groupProfile"],components:{ImageUpload:As,GroupMemberList:xs,KpActions:Ys,BotSwitch:Qs,ElSelect:p["Select"],ElOption:p["Option"],ElSwitch:p["Switch"]},data(){return{showEditName:!1,showEditFaceUrl:!1,showEditIntroduction:!1,showEditNotification:!1,showEditJoinOption:!1,showChangeGroupOwner:!1,showEditMessageRemindType:!1,showEditNameCard:!1,name:this.groupProfile.name,avatar:Object(De["b"])(this.groupProfile.avatar),displayAvatar:Object(De["b"])(this.groupProfile.avatar),introduction:this.groupProfile.introduction,notification:this.groupProfile.notification,joinOption:this.groupProfile.joinOption,newOwnerUserID:"",messageRemindType:this.groupProfile.selfInfo.messageRemindType,nameCard:this.groupProfile.selfInfo.nameCard||"",muteAllMembers:this.groupProfile.muteAllMembers,messageRemindTypeMap:{AcceptAndNotify:"接收消息并提示",AcceptNotNotify:"接收消息但不提示",Discard:"屏蔽消息"},joinOptionMap:{FreeAccess:"自由加入",NeedPermission:"需要验证",DisableApply:"禁止加群"},active:!1}},computed:{editable(){return this.groupProfile.type===this.TIM.TYPES.GRP_WORK||[this.TIM.TYPES.GRP_MBR_ROLE_OWNER,this.TIM.TYPES.GRP_MBR_ROLE_ADMIN].includes(this.groupProfile.selfInfo.role)},isOwner(){return this.groupProfile.selfInfo.role===this.TIM.TYPES.GRP_MBR_ROLE_OWNER},isAdmin(){return this.groupProfile.selfInfo.role===this.TIM.TYPES.GRP_MBR_ROLE_ADMIN},showDissmissGroup(){return this.isOwner&&this.groupProfile.type!==this.TIM.TYPES.GRP_WORK},groupType(){switch(this.groupProfile.type){case this.TIM.TYPES.GRP_WORK:return"好友工作群（Work）";case this.TIM.TYPES.GRP_PUBLIC:return"陌生人社交群（Public）";case this.TIM.TYPES.GRP_CHATROOM:return"临时会议群（Meeting）";case this.TIM.TYPES.GRP_AVCHATROOM:return"直播群（AVChatRoom）";default:return""}}},methods:{inputFocus(e){this.$nextTick(()=>{this.$refs[e].focus()})},editName(){this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,name:this.name.trim()}).then(()=>{this.showEditName=!1}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},editFaceUrl(){this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,avatar:Object(De["c"])(this.avatar)}).then(()=>{this.showEditFaceUrl=!1,this.displayAvatar=this.avatar.trim()}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},changeMuteStatus(){this.isOwner||this.isAdmin?this.tim.updateGroupProfile({muteAllMembers:this.muteAllMembers,groupID:this.groupProfile.groupID}).then(e=>{this.muteAllMembers=e.data.group.muteAllMembers,this.muteAllMembers?(this.active=!0,this.$store.commit("showMessage",{message:"全体禁言"})):(this.active=!1,this.$store.commit("showMessage",{message:"取消全体禁言"}))}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})}):(this.muteAllMembers=this.groupProfile.muteAllMembers,this.$store.commit("showMessage",{type:"error",message:"普通群成员不能对全体禁言"}))},editIntroduction(){this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,introduction:this.introduction.trim()}).then(()=>{this.showEditIntroduction=!1}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},editNotification(){this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,notification:this.notification.trim()}).then(()=>{this.showEditNotification=!1}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},editJoinOption(){this.tim.updateGroupProfile({groupID:this.groupProfile.groupID,joinOption:this.joinOption}).then(()=>{this.showEditJoinOption=!1}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},changeOwner(){this.tim.changeGroupOwner({groupID:this.groupProfile.groupID,newOwnerID:this.newOwnerUserID}).then(()=>{this.showChangeGroupOwner=!1,this.$store.commit("showMessage",{message:"转让群主成功，新群主ID："+this.newOwnerUserID}),this.newOwnerUserID=""}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},quitGroup(){this.tim.quitGroup(this.groupProfile.groupID).then(({data:{groupID:e}})=>{this.$store.commit("showMessage",{message:"退群成功"}),e===this.groupProfile.groupID&&this.$store.commit("resetCurrentConversation")}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},dismissGroup(){this.tim.dismissGroup(this.groupProfile.groupID).then(({data:{groupID:e}})=>{this.$store.commit("showMessage",{message:`群：${this.groupProfile.name||this.groupProfile.groupID}解散成功！`,type:"success"}),e===this.groupProfile.groupID&&this.$store.commit("resetCurrentConversation")}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},editMessageRemindType(){this.tim.setMessageRemindType({groupID:this.groupProfile.groupID,messageRemindType:this.messageRemindType}).then(()=>{this.showEditMessageRemindType=!1}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},editNameCard(){0!==this.nameCard.trim().length?this.tim.setGroupMemberNameCard({groupID:this.groupProfile.groupID,nameCard:this.nameCard.trim()}).then(()=>{this.showEditNameCard=!1}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})}):this.$store.commit("showMessage",{message:"不能设置空的群名片",type:"warning"})}}},Zs=Xs,er=(s("0716"),Object(y["a"])(Zs,cs,ls,!1,null,null,null)),tr=er.exports,sr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"log-switch"},[s("div",{staticClass:"label"},[e._v("启用 Log")]),s("el-switch",{attrs:{value:e.currentGame.logEnabled},on:{input:function(t){return e.$store.commit("toggleLogEnabled",{groupId:e.groupProfile.groupID,enabled:t})}}})],1),s("div",{staticClass:"btn-container"},[s("el-button-group",[s("el-button",{attrs:{size:"small"},on:{click:e.exportText}},[e._v("导出为文本")]),s("el-button",{attrs:{size:"small"},on:{click:e.exportHTML}},[e._v("导出为HTML")]),s("el-button",{attrs:{size:"small"},on:{click:e.exportJson}},[e._v("导出为JSON")]),s("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.clearAllLogs}},[e._v("清空")])],1)],1),s("div",{ref:"draggable",staticClass:"log-container"},e._l(e.currentGame.logs,(function(t){return s("div",{key:t.id,staticClass:"log-item"},[s("div",[s("i",{staticClass:"el-icon-rank handle"}),s("div",{staticClass:"nick",attrs:{title:t.from}},[e._v(e._s(t.nick||t.from))]),s("div",{staticClass:"content",attrs:{title:e.formatTime(t.time)}},[e._v(e._s(t.content))])]),s("i",{staticClass:"el-icon-close delete",on:{click:function(s){return e.onDeleteLog(t.id)}}})])})),0)])},rr=[],ir=s("a352"),or=s.n(ir);function nr(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function ar(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?nr(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):nr(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const cr="\n.chat-item {\n    padding: 4px;\n}\n\n.chat-item-name {\n    font-weight: bold;\n}\n\n.chat-user-bot {\n    background-color: #ffffe0;\n}\n/* xxx 替换成实际的 userid */\n.chat-user-xxx {\n    background-color: #e0ffff;\n}";var lr={props:["groupProfile"],components:{ElSwitch:p["Switch"]},computed:ar({},Object(c["mapState"])({currentGame:e=>e.game.list[e.conversation.currentConversation.groupProfile.groupID]})),mounted(){or.a.create(this.$refs.draggable,{handle:".handle",ghostClass:"moving",onEnd:({newIndex:e,oldIndex:t})=>{const s=this.currentGame.logs.splice(t,1)[0];this.currentGame.logs.splice(e,0,s),this.$store.commit("updateLogs",{groupId:this.groupProfile.groupID,logs:this.currentGame.logs})}})},methods:{formatTime(e){return N(new Date(1e3*e))},onDeleteLog(e){this.$store.commit("updateLogs",{groupId:this.groupProfile.groupID,logs:this.currentGame.logs.filter(t=>t.id!==e)})},clearAllLogs(){this.$store.commit("updateLogs",{groupId:this.groupProfile.groupID,logs:[]})},exportText(){let e="",t="";this.currentGame.logs.forEach(s=>{let r=s.nick||s.from;r!==e&&(t+=`${r} ${this.formatTime(s.time)}\n`),t+=s.content+"\n",e=r}),this.download("text",t)},exportHTML(){let e="",t="";this.currentGame.logs.forEach(s=>{let r=s.nick||s.from;r!==e?(""!==t&&(t+="</div>"),t+=`<div class='chat-item chat-user-${s.from}'><div class='meta'><span class='chat-item-name'>${r}</span><span class='chat-item-time'>${this.formatTime(s.time)}</span></div><div class='content'>${s.content}</div>`):t+=`<div class='content'>${s.content}</div>`,e=r}),""!==t&&(t+="</div>"),t+=`<style>${cr}</style>`,this.download("html",t)},exportJson(){this.download("json",JSON.stringify(this.currentGame.logs))},download(e,t){const s=document.createElement("a");s.setAttribute("href",`data:${e}/plain;charset=utf-8,`+encodeURIComponent(t)),s.setAttribute("download","log."+("text"===e?"txt":e)),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}},ur=lr,pr=(s("9c50"),Object(y["a"])(ur,sr,rr,!1,null,"7f13ea18",null)),mr=pr.exports,hr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-alert",{attrs:{title:"主持人发布的重要笔记将会显示在这里",type:"info",description:"你也可以把自己觉得重要的消息收藏在这里（敬请期待）","show-icon":""}}),s("bgm",{attrs:{bgm:e.currentGame.bgm}}),s("div",{ref:"draggable",staticClass:"card-list"},e._l(e.currentGame.notes,(function(t){return s("el-card",{key:t.id,staticClass:"card",attrs:{shadow:"hover"}},[t.type===e.TIM.TYPES.MSG_TEXT?s("div",{staticClass:"note-text"},[e._v(e._s(t.payload))]):t.type===e.TIM.TYPES.MSG_IMAGE?s("img",{staticClass:"note-img",attrs:{src:e.formatUrl(t.payload)},on:{click:function(s){return e.handlePreview(t.payload)}}}):e._e(),s("div",{staticClass:"tools"},[s("el-button",{attrs:{icon:"el-icon-copy-document",size:"mini",circle:""},on:{click:function(s){return e.handleCopyCard(t.payload)}}}),s("el-button",{attrs:{icon:"el-icon-close",size:"mini",circle:""},on:{click:function(s){return e.handleDelete(t.id)}}})],1)])})),1)],1)},dr=[],gr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return 1===e.bgm.platform?s("iframe",{key:e.bgm.id,staticClass:"player",attrs:{frameborder:"no",border:"0",marginwidth:"0",marginheight:"0",height:2===e.bgm.type?110:235,src:"//music.163.com/outchain/player?type="+e.bgm.type+"&id="+e.bgm.id}}):e._e()},fr=[],br={props:["bgm"]},vr=br,yr=(s("831a"),Object(y["a"])(vr,gr,fr,!1,null,"33e8d0dc",null)),Or=yr.exports;function Cr(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function wr(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Cr(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var _r={props:["groupProfile"],components:{bgm:Or},computed:wr({},Object(c["mapState"])({currentGame:e=>e.game.list[e.conversation.currentConversation.groupProfile.groupID]})),mounted(){or.a.create(this.$refs.draggable,{ghostClass:"moving",onEnd:({newIndex:e,oldIndex:t})=>{const s=this.currentGame.notes.splice(t,1)[0];this.currentGame.notes.splice(e,0,s),this.$store.commit("updateNotes",{groupId:this.groupProfile.groupID,notes:this.currentGame.notes})}})},methods:{formatUrl(e){return"//"===e.slice(0,2)?"https:"+e:e},handlePreview(e){this.$bus.$emit("image-preview",{url:e})},handleCopyCard(e){this.$copyText(e).then(()=>{this.$store.commit("showMessage",{type:"success",message:"复制成功"})})},handleDelete(e){const t=this.currentGame.notes.filter(t=>t.id!==e);this.$store.commit("updateNotes",{groupId:this.groupProfile.groupID,notes:t})}}},Pr=_r,jr=(s("b428"),Object(y["a"])(Pr,hr,dr,!1,null,"730f4c82",null)),Mr=jr.exports,Ir=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{padding:"20px"}},[s("div",{staticClass:"simple-info"},[s("div",[e._v(e._s(e.currentCard.basic.name))]),s("div",[e._v(e._s(e.currentCard.basic.gender))]),s("div",[e._v(e._s(e.currentCard.basic.age+"岁"))]),s("div",[e._v(e._s(e.currentCard.basic.job))])]),e._m(0),s("el-table",{attrs:{data:[e.currentCard.basic],"row-class-name":"row","header-row-class-name":"row"},on:{"cell-click":e.onBasicClick}},[s("el-table-column",{attrs:{prop:"hp",label:"体力"}}),s("el-table-column",{attrs:{prop:"san",label:"理智"}}),s("el-table-column",{attrs:{prop:"luck",label:"幸运"}}),s("el-table-column",{attrs:{prop:"mp",label:"魔法"}})],1),s("div",{staticClass:"section"},[s("h4",{staticClass:"section-title"},[e._v("基础属性")]),s("el-input",{staticStyle:{width:"150px"},attrs:{clearable:"","prefix-icon":"el-icon-search",size:"mini"},model:{value:e.searchProp,callback:function(t){e.searchProp=t},expression:"searchProp"}})],1),s("el-table",{attrs:{data:e.filterProps(),stripe:"","row-class-name":"row","header-row-class-name":"row"},on:{"cell-click":e.onCellClick}},[s("el-table-column",{attrs:{prop:"name",label:"属性"}}),s("el-table-column",{attrs:{prop:"value",sortable:"",label:"%"}}),s("el-table-column",{attrs:{label:"半值"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(Math.floor(t.row.value/2)))]}}])}),s("el-table-column",{attrs:{label:"1/5值"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(Math.floor(t.row.value/5)))]}}])})],1),s("div",{staticClass:"section"},[s("h4",{staticClass:"section-title"},[e._v("技能表")]),s("el-input",{staticStyle:{width:"150px"},attrs:{clearable:"","prefix-icon":"el-icon-search",size:"mini"},model:{value:e.searchSkill,callback:function(t){e.searchSkill=t},expression:"searchSkill"}})],1),s("el-table",{attrs:{data:e.filterSkills(),stripe:"","row-class-name":"row","header-row-class-name":"row"},on:{"cell-click":e.onCellClick}},[s("el-table-column",{attrs:{type:"selection",width:"30","class-name":"select-col"}}),s("el-table-column",{attrs:{prop:"name",label:"属性",width:"105"}}),s("el-table-column",{attrs:{prop:"value",sortable:"",label:"%"}}),s("el-table-column",{attrs:{label:"半值"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(Math.floor(t.row.value/2)))]}}])}),s("el-table-column",{attrs:{label:"1/5值"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(Math.floor(t.row.value/5)))]}}])})],1)],1)},xr=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tips"},[e._v("点击下方对应的数值格子可以快速投骰；\n    "),s("br"),e._v("点击属性名称可以复制；\n    "),s("br"),e._v("点击表头可以将属性和技能按成功率排序；\n    "),s("br"),e._v("可按中文或拼音首字母搜索。\n  ")])}];function Tr(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Sr(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Tr(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Tr(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Er={props:["member"],data(){return{searchProp:"",searchSkill:""}},computed:Sr(Sr({},Object(c["mapState"])({currentGame:e=>e.game.list[e.conversation.currentConversation.groupProfile.groupID],currentCard:function(){return this.currentGame.cards["o"+this.member]}})),{},{props:function(){return Object.keys(this.currentCard.props).map(e=>({name:e,value:this.currentCard.props[e],pinyin:$e[e]||""}))},skills:function(){return Object.keys(this.currentCard.skills).map(e=>({name:e,value:this.currentCard.skills[e],pinyin:Ge[e]||""}))}}),methods:{filterProps(){return""===this.searchProp?this.props:this.props.filter(e=>e.name.includes(this.searchProp)||e.pinyin.includes(this.searchProp.toLowerCase()))},filterSkills(){return""===this.searchSkill?this.skills:this.skills.filter(e=>e.name.includes(this.searchSkill)||e.pinyin.includes(this.searchSkill.toLowerCase()))},onCellClick(e,t){if("属性"===t.label)return void this.$copyText(e.name).then(()=>{this.$store.commit("showMessage",{type:"success",message:"复制成功"})});let s="半值"===t.label?"困难":"1/5值"===t.label?"极难":"",r=document.getElementById("ghost-message-send-box");r.innerText=".d% "+s+e.name,r.click()},onBasicClick(e,t){if("理智"===t.label||"幸运"===t.label){let e=document.getElementById("ghost-message-send-box");e.innerText=".d% "+t.label,e.click()}}}},kr=Er,Dr=(s("5b99"),Object(y["a"])(kr,Ir,xr,!1,null,"4c2784f5",null)),$r=Dr.exports;function Gr(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Ar(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Gr(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Gr(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Lr={name:"RightPanel",components:{LogPanel:mr,NotePanel:Mr,CardPanel:$r,GroupProfile:tr},data(){return{activeName:"group"}},computed:Ar({},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation,currentGame:e=>e.game.list[e.conversation.currentConversation.groupProfile.groupID],allTabs(){return this.currentGame.openedCards}})),mounted(){const e=document.querySelector(".group-right-panels div[role=tablist]");or.a.create(e,{onEnd:({newIndex:e,oldIndex:t})=>{const s=this.allTabs.splice(t,1)[0];this.allTabs.splice(e,0,s),this.$store.commit("setOpenedUserCards",{groupId:this.currentConversation.groupProfile.groupID,list:this.allTabs})}})},methods:{handleClick(e){"note"===e.name&&this.$store.commit("setNoteUnread",{groupId:this.currentConversation.groupProfile.groupID,unread:!1})},handleRemove(e){this.$store.dispatch("closeUserCard",{groupId:this.currentConversation.groupProfile.groupID,userId:e})},getCardName(e){return this.currentGame.cards["o"+e].basic.name}}},Rr=Lr,Ur=(s("13c8"),Object(y["a"])(Rr,ns,as,!1,null,"2c135f5f",null)),Nr=Ur.exports;function Br(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Yr(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Br(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Br(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Fr={name:"CurrentConversation",components:{MessageSendBox:I,MessageItem:Lt,ConversationProfile:Zt,MemberProfileCard:os,RightPanel:Nr},data(){return{isShowScrollButtomTips:!1,preScrollHeight:0,showConversationProfile:!0,timeout:""}},computed:Yr(Yr(Yr({},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation,currentUnreadCount:e=>e.conversation.currentConversation.unreadCount,currentMessageList:e=>e.conversation.currentMessageList,isCompleted:e=>e.conversation.isCompleted,groupProfile:e=>e.conversation.currentConversation.groupProfile,currentGame:e=>{var t;return e.game.list[null===(t=e.conversation.currentConversation.groupProfile)||void 0===t?void 0:t.groupID]}})),Object(c["mapGetters"])(["toAccount","hidden"])),{},{name(){return"C2C"===this.currentConversation.type?this.currentConversation.userProfile.nick||this.toAccount:"GROUP"===this.currentConversation.type?this.currentConversation.groupProfile.name||this.toAccount:"@TIM#SYSTEM"===this.currentConversation.conversationID?"系统通知":this.toAccount},showMessageSendBox(){return this.currentConversation.type!==this.TIM.TYPES.CONV_SYSTEM},backgroundUrl(){var e;return null===(e=this.currentGame)||void 0===e?void 0:e.scene}}),mounted(){if(this.$bus.$on("image-loaded",this.onImageLoaded),this.$bus.$on("scroll-bottom",this.scrollMessageListToButtom),"@TIM#SYSTEM"===this.currentConversation.conversationID)return!1},updated(){this.keepMessageListOnButtom()},watch:{currentUnreadCount(e){!this.hidden&&e>0&&this.tim.setMessageRead({conversationID:this.currentConversation.conversationID})},hidden(e){!e&&this.currentUnreadCount>0&&this.tim.setMessageRead({conversationID:this.currentConversation.conversationID})}},methods:{onScroll({target:{scrollTop:e}}){let t=this.$refs["message-list"];t&&this.preScrollHeight-t.clientHeight-e<20&&(this.isShowScrollButtomTips=!1)},keepMessageListOnButtom(){let e=this.$refs["message-list"];e&&(this.preScrollHeight-e.clientHeight-e.scrollTop<20?(this.$nextTick(()=>{e.scrollTop=e.scrollHeight}),this.isShowScrollButtomTips=!1):this.isShowScrollButtomTips=!0,this.preScrollHeight=e.scrollHeight)},scrollMessageListToButtom(){this.$nextTick(()=>{let e=this.$refs["message-list"];e&&(e.scrollTop=e.scrollHeight,this.preScrollHeight=e.scrollHeight,this.isShowScrollButtomTips=!1)})},showMore(){this.showConversationProfile=!this.showConversationProfile},onImageLoaded(){this.keepMessageListOnButtom()}}},Vr=Fr,zr=(s("bf00"),Object(y["a"])(Vr,n,a,!1,null,"be78eb64",null)),qr=zr.exports,Hr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"side-bar-wrapper"},[s("div",{staticClass:"bar-left"},[s("div",{staticClass:"tab-items",on:{click:e.handleClick}},[s("div",{staticClass:"iconfont icon-conversation",class:{active:e.showConversationList},attrs:{id:"conversation-list",title:"会话列表"}},[0!==e.totalUnreadCount?s("sup",{staticClass:"unread"},[e.totalUnreadCount>99?[e._v("99+")]:[e._v(e._s(e.totalUnreadCount))]],2):e._e()]),s("div",{staticClass:"iconfont icon-group",class:{active:e.showGroupList},attrs:{id:"group-list",title:"群组列表"}}),s("div",{staticClass:"iconfont icon-blacklist",class:{active:e.showBlackList},attrs:{id:"black-list",title:"黑名单列表"}})]),s("div",{staticClass:"bottom"},[s("div",{staticClass:"iconfont icon-zidingyi",attrs:{title:"设置"},on:{click:function(t){e.globalSettingsVisible=!0}}}),s("global-setting",{attrs:{visible:e.globalSettingsVisible},on:{"update:visible":function(t){e.globalSettingsVisible=t}}}),s("div",{staticClass:"iconfont icon-tuichu",attrs:{title:"退出"},on:{click:e.handleExit}})],1)]),s("div",{staticClass:"bar-right"},[s("conversation-list",{directives:[{name:"show",rawName:"v-show",value:e.showConversationList,expression:"showConversationList"}]}),s("group-list",{directives:[{name:"show",rawName:"v-show",value:e.showGroupList,expression:"showGroupList"}]}),s("friend-list",{directives:[{name:"show",rawName:"v-show",value:e.showFriendList,expression:"showFriendList"}]}),s("black-list",{directives:[{name:"show",rawName:"v-show",value:e.showBlackList,expression:"showBlackList"}]})],1)])},Jr=[],Wr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"list-container"},[s("div",{staticClass:"scroll-container"},e._l(e.conversationList,(function(e){return s("conversation-item",{key:e.conversationID,attrs:{conversation:e}})})),1)])},Kr=[],Qr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"conversation-item-container",class:{choose:e.conversation.conversationID===e.currentConversation.conversationID},on:{click:e.selectConversation}},[s("div",{staticClass:"close-btn"},[s("span",{staticClass:"tim-icon-close",attrs:{title:"删除会话"},on:{click:e.deleteConversation}})]),s("div",{staticClass:"warp"},[s("avatar",{attrs:{src:e.avatar,type:e.conversation.type}}),s("div",{staticClass:"content"},[s("div",{staticClass:"row-1"},[s("div",{staticClass:"name"},[s("div",{staticClass:"text-ellipsis"},[e.conversation.type===e.TIM.TYPES.CONV_C2C?s("span",{attrs:{title:e.conversation.userProfile.nick||e.conversation.userProfile.userID}},[e._v(e._s(e.conversation.userProfile.nick||e.conversation.userProfile.userID)+"\n            ")]):e.conversation.type===e.TIM.TYPES.CONV_GROUP?s("span",{attrs:{title:e.conversation.groupProfile.name||e.conversation.groupProfile.groupID}},[e._v(e._s(e.conversation.groupProfile.name||e.conversation.groupProfile.groupID)+"\n            ")]):e.conversation.type===e.TIM.TYPES.CONV_SYSTEM?s("span",[e._v("系统通知\n            ")]):e._e()])]),s("div",{staticClass:"unread-count"},[e.showUnreadCount?s("span",{staticClass:"badge"},[e._v("\n            "+e._s(e.conversation.unreadCount>99?"99+":e.conversation.unreadCount)+"\n          ")]):e._e()])]),s("div",{staticClass:"row-2"},[s("div",{staticClass:"summary"},[e.conversation.lastMessage?s("div",{staticClass:"text-ellipsis"},[e.hasMessageAtMe?s("span",{staticClass:"remind",staticStyle:{color:"red"}},[e._v("[有人提到我]")]):e._e(),s("span",{staticClass:"text",attrs:{title:e.conversation.lastMessage.messageForShow}},[e._v("\n              "+e._s(e.messageForShow)+"\n            ")])]):e._e()]),s("div",{staticClass:"date"},[e._v("\n          "+e._s(e.date)+"\n        ")])])])],1)])},Xr=[];function Zr(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function ei(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Zr(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Zr(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var ti={name:"conversation-item",props:["conversation"],data(){return{popoverVisible:!1,hasMessageAtMe:!1}},computed:ei(ei({showUnreadCount(){return(this.$store.getters.hidden||this.currentConversation.conversationID!==this.conversation.conversationID)&&this.conversation.unreadCount>0},date(){if(!this.conversation.lastMessage||!this.conversation.lastMessage.lastTime)return"";const e=new Date(1e3*this.conversation.lastMessage.lastTime);return B(e)?U(e):R(e)},avatar:function(){switch(this.conversation.type){case"GROUP":return Object(De["b"])(this.conversation.groupProfile.avatar);case"C2C":return this.conversation.userProfile.avatar;default:return""}},conversationName:function(){return this.conversation.type===this.TIM.TYPES.CONV_C2C?this.conversation.userProfile.nick||this.conversation.userProfile.userID:this.conversation.type===this.TIM.TYPES.CONV_GROUP?this.conversation.groupProfile.name||this.conversation.groupProfile.groupID:this.conversation.type===this.TIM.TYPES.CONV_SYSTEM?"系统通知":""},showGrayBadge(){return this.conversation.type===this.TIM.TYPES.CONV_GROUP&&"AcceptNotNotify"===this.conversation.groupProfile.selfInfo.messageRemindType},messageForShow(){return this.conversation.lastMessage.isRevoked?this.conversation.lastMessage.fromAccount===this.currentUserProfile.userID?"你撤回了一条消息":this.conversation.type===this.TIM.TYPES.CONV_C2C?"对方撤回了一条消息":this.conversation.lastMessage.fromAccount+"撤回了一条消息":this.conversation.lastMessage.messageForShow}},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation,currentUserProfile:e=>e.user.currentUserProfile})),Object(c["mapGetters"])(["toAccount"])),mounted(){this.$bus.$on("new-messsage-at-me",e=>{e.data.conversationID===this.conversation.conversationID&&this.conversation.conversationID!==this.currentConversation.conversationID&&(this.hasMessageAtMe=!0)})},methods:{selectConversation(){this.conversation.conversationID!==this.currentConversation.conversationID&&this.$store.dispatch("checkoutConversation",this.conversation.conversationID)},deleteConversation(e){e.stopPropagation(),this.tim.deleteConversation(this.conversation.conversationID).then(()=>{this.$store.commit("showMessage",{message:`会话【${this.conversationName}】删除成功!`,type:"success"}),this.popoverVisible=!1,this.$store.commit("resetCurrentConversation")}).catch(e=>{this.$store.commit("showMessage",{message:`会话【${this.conversationName}】删除失败!, error=${e.message}`,type:"error"}),this.popoverVisible=!1})},showContextMenu(){this.popoverVisible=!0}},watch:{currentConversation(e){e.conversationID===this.conversation.conversationID&&(this.hasMessageAtMe=!1)}}},si=ti,ri=(s("59b9"),Object(y["a"])(si,Qr,Xr,!1,null,"861cfe8a",null)),ii=ri.exports;function oi(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function ni(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?oi(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):oi(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var ai={name:"ConversationList",components:{ConversationItem:ii},computed:ni({},Object(c["mapState"])({conversationList:e=>e.conversation.conversationList,currentConversation:e=>e.conversation.currentConversation}))},ci=ai,li=(s("e4f5"),Object(y["a"])(ci,Wr,Kr,!1,null,"69e02b5e",null)),ui=li.exports,pi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"list-container"},[s("div",{staticClass:"group-container"},e._l(e.groupList,(function(e){return s("group-item",{key:e.groupID,attrs:{group:e}})})),1)])},mi=[],hi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-form",{ref:"createGroupForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"群名称",prop:"name"}},[s("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:"群头像"}},[s("image-upload",{model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}})],1)],1),s("div",{staticClass:"dialog-footer",style:{"text-align":"right"},attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.closeCreateGroupModel}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("createGroupForm")}}},[e._v("立即创建")])],1)],1)},di=[];function gi(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function fi(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?gi(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):gi(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var bi={components:{ImageUpload:As,ElForm:p["Form"],ElFormItem:p["FormItem"],ElInput:p["Input"],ElSelect:p["Select"],ElOption:p["Option"],ElRadioGroup:p["RadioGroup"],ElRadio:p["Radio"]},data(){return{form:{groupID:"",name:"",type:this.TIM.TYPES.GRP_PUBLIC,avatar:"",introduction:"",notification:"",joinOption:"FreeAccess",memberList:[]},options:[],loading:!1,rules:{name:[{required:!0,message:"请输入群名称",trigger:"blur"}]}}},computed:{joinOptionDisabled(){return[this.TIM.TYPES.GRP_WORK,this.TIM.TYPES.GRP_MEETING,this.TIM.TYPES.GRP_AVCHATROOM].includes(this.form.type)}},methods:{onSubmit(e){this.$refs[e].validate(e=>{if(!e)return!1;this.createGroup()})},closeCreateGroupModel(){this.$store.commit("updateCreateGroupModelVisible",!1)},createGroup(){this.tim.createGroup(this.getOptions()).then(e=>{this.$store.commit("showMessage",{message:`群组：【${e.data.group.name}】创建成功`,type:"success"}),this.closeCreateGroupModel()}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},getOptions(){let e=fi(fi({},this.form),{},{memberList:this.form.memberList.map(e=>({userID:e}))});return[this.TIM.TYPES.GRP_WORK,this.TIM.TYPES.GRP_AVCHATROOM].includes(this.form.type)&&delete e.joinOption,e},handleSearchUser(e){""!==e&&(this.loading=!0,this.tim.getUserProfile({userIDList:[e]}).then(({data:e})=>{this.options=e.map(e=>e.userID),this.loading=!1}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})}))}}},vi=bi,yi=Object(y["a"])(vi,hi,di,!1,null,"6ae4ec4c",null),Oi=yi.exports,Ci=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"scroll-container",on:{click:e.handleGroupClick}},[s("div",{staticClass:"group-item"},[s("avatar",{attrs:{src:e.avatar}}),s("div",{staticClass:"group-name text-ellipsis"},[e._v(e._s(e.group.name))])],1)])},wi=[],_i={props:["group"],computed:{avatar(){return Object(De["b"])(this.group.avatar)}},data(){return{visible:!1,options:[{text:"退出群组",handler:this.quitGroup}]}},methods:{handleGroupClick(){const e="GROUP"+this.group.groupID;this.$store.dispatch("checkoutConversation",e)},quitGroup(){this.tim.quitGroup(this.group.groupID).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})}}},Pi=_i,ji=(s("94e1"),Object(y["a"])(Pi,Ci,wi,!1,null,"edeeeea4",null)),Mi=ji.exports;function Ii(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function xi(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Ii(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Ii(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Ti={data(){return{groupID:"",hideSearchLoading:!0}},components:{GroupItem:Mi,ElDialog:p["Dialog"],CreateGroup:Oi,ElAutocomplete:p["Autocomplete"]},computed:xi({groupList:function(){return this.$store.state.group.groupList}},Object(c["mapState"])({createGroupModelVisible:e=>e.group.createGroupModelVisible})),methods:{onGroupUpdated(e){this.$store.dispatch("updateGroupList",e)},createGroup(){},closeCreateGroupModel(){this.$store.commit("updateCreateGroupModelVisible",!1)},searchGroupByID(e,t){e.trim().length>0?(this.hideSearchLoading=!1,this.tim.searchGroupByID(e).then(({data:{group:e}})=>{t([e])}).catch(()=>{this.$store.commit("showMessage",{message:"没有找到该群",type:"error"})})):this.hideSearchLoading=!0},showCreateGroupModel(){this.$store.commit("updateCreateGroupModelVisible",!0)},applyJoinGroup(e){this.tim.joinGroup({groupID:e.groupID}).then(async e=>{switch(e.data.status){case this.TIM.TYPES.JOIN_STATUS_WAIT_APPROVAL:this.$store.commit("showMessage",{message:"申请成功，等待群管理员确认。",type:"info"});break;case this.TIM.TYPES.JOIN_STATUS_SUCCESS:await this.$store.dispatch("checkoutConversation","GROUP"+e.data.group.groupID),this.$store.commit("showMessage",{message:"加群成功",type:"success"});break;case this.TIM.TYPES.JOIN_STATUS_ALREADY_IN_GROUP:this.$store.commit("showMessage",{message:"您已经是群成员了，请勿重复加群哦！",type:"info"});break;default:break}}).catch(e=>{this.$store.commit("showMessage",{message:e.message,type:"error"})})}}},Si=Ti,Ei=(s("7ba6"),Object(y["a"])(Si,pi,mi,!1,null,"4dedbdfc",null)),ki=Ei.exports,Di=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"friend-list-container",class:{default:!e.hasFriend}},[e.hasFriend?s("div",e._l(e.friendList,(function(e){return s("friend-item",{key:e.userID,attrs:{friend:e}})})),1):s("div",{staticStyle:{color:"gray"}},[e._v("暂无好友")])])},$i=[],Gi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticClass:"friend-item-container"},[s("el-col",{attrs:{span:6}},[s("avatar",{attrs:{src:e.friend.profile.avatar}})],1),s("el-col",{attrs:{span:18}},[s("div",{staticClass:"friend-name"},[e._v(e._s(e.friend.profile.nick||e.friend.userID))])])],1)],1)},Ai=[],Li={props:{friend:{type:Object,required:!0}},methods:{handleFriendClick(){this.tim.getConversationProfile("C2C"+this.friend.userID).then(({data:e})=>{this.$store.commit("updateCurrentConversation",e)}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})}}},Ri=Li,Ui=Object(y["a"])(Ri,Gi,Ai,!1,null,"0e5cffba",null),Ni=Ui.exports;function Bi(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Yi(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Bi(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Bi(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Fi={components:{FriendItem:Ni},computed:Yi(Yi({},Object(c["mapState"])({friendList:e=>e.friend.friendList})),{},{hasFriend(){return this.friendList.length>0}})},Vi=Fi,zi=(s("47b1"),Object(y["a"])(Vi,Di,$i,!1,null,null,null)),qi=zi.exports,Hi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"blacklist-wrapper",class:{default:!e.hasBlacklist}},[e.hasBlacklist?s("div",e._l(e.blacklist,(function(e){return s("blacklist-item",{key:e.userID,attrs:{profile:e}})})),1):s("span",{staticStyle:{color:"gray"}},[e._v("黑名单还是空的")])])},Ji=[],Wi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"blacklist-item-wrapper"},[s("img",{staticClass:"avatar",attrs:{src:e.profile.avatar?e.profile.avatar:"http://imgcache.qq.com/open/qcloud/video/act/webim-avatar/avatar-2.png"}}),s("div",{staticClass:"item"},[e._v(e._s(e.profile.nick||e.profile.userID))]),s("el-button",{attrs:{type:"text"},on:{click:e.removeFromBlacklist}},[e._v("取消拉黑")])],1)},Ki=[],Qi={name:"BlacklistItem",props:{profile:{type:Object,required:!0}},methods:{removeFromBlacklist(){this.tim.removeFromBlacklist({userIDList:[this.profile.userID]}).then(()=>{this.$store.commit("removeFromBlacklist",this.profile.userID)}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})}}},Xi=Qi,Zi=(s("b849"),Object(y["a"])(Xi,Wi,Ki,!1,null,"6763cfe2",null)),eo=Zi.exports;function to(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function so(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?to(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):to(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var ro={name:"Blacklist",components:{BlacklistItem:eo},computed:so(so({},Object(c["mapState"])({blacklist:e=>e.blacklist.blacklist})),{},{hasBlacklist(){return this.blacklist.length>0}})},io=ro,oo=(s("86b5"),Object(y["a"])(io,Hi,Ji,!1,null,"00ad617d",null)),no=oo.exports,ao=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"全局设置",width:"40%",visible:e.visible},on:{close:function(t){return e.$emit("update:visible",!1)}}},[s("div",{staticClass:"settings-content"},[s("div",[e._v("【重要笔记】/【Log】/【人物卡】的内容，会缓存在本地，这样在下次打开时也不会丢失。")]),s("div",[e._v("如果你已经不需要这些缓存了，可以将其清除，以释放存储空间、提升初始化速度。")]),s("div",{staticClass:"btn",staticStyle:{"margin-top":"20px"}},[s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clearLocalStorage("paotuannote-")}}},[e._v("清除所有【重要笔记】缓存")])],1),s("div",{staticClass:"btn"},[s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clearLocalStorage("paotuanlog-")}}},[e._v("清除所有【Log 录制】缓存")])],1),s("div",{staticClass:"btn"},[s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.clearLocalStorage("paotuancard-")}}},[e._v("清除所有【人物卡】缓存")])],1)])])},co=[],lo={props:["visible"],methods:{clearLocalStorage(e){const t=[],s=localStorage.length;for(let r=0;r<s;r++){const s=localStorage.key(r);s.startsWith(e)&&t.push(s)}t.forEach(e=>localStorage.removeItem(e)),this.$store.commit("showMessage",{type:"success",message:"清除缓存成功"})}}},uo=lo,po=(s("7028"),Object(y["a"])(uo,ao,co,!1,null,"1631b65b",null)),mo=po.exports;function ho(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function go(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ho(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ho(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const fo={CONVERSATION_LIST:"conversation-list",GROUP_LIST:"group-list",FRIEND_LIST:"friend-list",BLACK_LIST:"black-list"};var bo={name:"SideBar",components:{ConversationList:ui,GroupList:ki,FriendList:qi,BlackList:no,GlobalSetting:mo},data(){return{active:fo.CONVERSATION_LIST,activeName:fo,globalSettingsVisible:!1}},computed:go(go(go({},Object(c["mapGetters"])(["totalUnreadCount"])),Object(c["mapState"])({userID:e=>e.user.userID})),{},{showConversationList(){return this.active===fo.CONVERSATION_LIST},showGroupList(){return this.active===fo.GROUP_LIST},showFriendList(){return this.active===fo.FRIEND_LIST},showBlackList(){return this.active===fo.BLACK_LIST},showAddButton(){return[fo.CONVERSATION_LIST,fo.GROUP_LIST].includes(this.active)}}),methods:{checkoutActive(e){this.active=e},handleClick(e){switch(e.target.id){case fo.CONVERSATION_LIST:this.checkoutActive(fo.CONVERSATION_LIST);break;case fo.GROUP_LIST:this.checkoutActive(fo.GROUP_LIST);break;case fo.FRIEND_LIST:this.checkoutActive(fo.FRIEND_LIST);break;case fo.BLACK_LIST:this.checkoutActive(fo.BLACK_LIST);break}},handleRefresh(){switch(this.active){case fo.CONVERSATION_LIST:this.tim.getConversationList().catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})});break;case fo.GROUP_LIST:this.getGroupList();break;case fo.FRIEND_LIST:this.getFriendList();break;case fo.BLACK_LIST:this.$store.dispatch("getBlacklist");break}},getGroupList(){this.tim.getGroupList().then(({data:e})=>{this.$store.dispatch("updateGroupList",e)}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},getFriendList(){this.tim.getFriendList().then(({data:e})=>{this.$store.commit("upadteFriendList",e)}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})}).catch(e=>{this.$store.commit("showMessage",{type:"error",message:e.message})})},handleExit(){this.$confirm("确定要退出登录吗？").then(()=>{this.$store.dispatch("logout"),Object(ms["f"])()})}}},vo=bo,yo=(s("550c"),Object(y["a"])(vo,Hr,Jr,!1,null,"a435f666",null)),Oo=yo.exports,Co=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"profile-container"},[s("my-profile"),s("div",{staticClass:"base-info"},[s("div",{staticClass:"nick"},[e._v(e._s(e.currentUserProfile.nick||e.currentUserProfile.userID))]),s("div",{staticClass:"uid"},[e._v(e._s(e.currentUserProfile.userID))])]),s("div",{staticClass:"header-bar"},[s("button",{attrs:{title:"刷新列表"},on:{click:e.handleRefresh}},[s("i",{staticClass:"tim-icon-refresh"})]),s("el-dropdown",{on:{command:e.handleCreateChat}},[s("button",{staticClass:"btn2",attrs:{title:"创建会话"}},[s("i",{staticClass:"tim-icon-add"})]),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"group"}},[e._v("创建群聊")]),s("el-dropdown-item",{attrs:{command:"c2c"}},[e._v("发起单聊")])],1)],1)],1),s("div",{staticClass:"appid-prefix"},[e._v("PID "+e._s(e.currentAppid))]),s("el-dialog",{attrs:{title:"发起会话",visible:e.showC2CDialog,width:"40%"},on:{"update:visible":function(t){e.showC2CDialog=t}}},[s("el-input",{attrs:{placeholder:"请输入用户ID(QQ号)"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCreateC2C(t)}},model:{value:e.userID,callback:function(t){e.userID=t},expression:"userID"}}),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showC2CDialog=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.handleCreateC2C}},[e._v("确 定")])],1)],1),s("el-dialog",{attrs:{title:"创建群组",visible:e.createGroupModelVisible,width:"40%"},on:{close:function(t){return e.$store.commit("updateCreateGroupModelVisible",!1)}}},[s("create-group")],1)],1)},wo=[],_o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"my-profile-wrapper"},[s("el-dialog",{attrs:{title:"编辑个人资料",visible:e.showEditMyProfile,width:"40%"},on:{"update:visible":function(t){e.showEditMyProfile=t}}},[s("el-form",{attrs:{"label-width":"60px"},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[s("el-form-item",{staticClass:"avatar-edit",attrs:{label:"头像"}},[s("image-upload",{staticStyle:{"flex-grow":"1"},model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}}),s("el-button",{attrs:{type:"primary"},on:{click:e.useQQAvatar}},[e._v("使用我的QQ头像")])],1),s("el-form-item",{attrs:{label:"昵称"}},[s("el-input",{attrs:{placeholder:"昵称"},model:{value:e.form.nick,callback:function(t){e.$set(e.form,"nick",t)},expression:"form.nick"}})],1),s("el-form-item",{attrs:{label:"性别"}},[s("el-radio-group",{model:{value:e.form.gender,callback:function(t){e.$set(e.form,"gender",t)},expression:"form.gender"}},[s("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_MALE}},[e._v("男")]),s("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_FEMALE}},[e._v("女")]),s("el-radio",{attrs:{label:e.TIM.TYPES.GENDER_UNKNOWN}},[e._v("不显示")])],1)],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showEditMyProfile=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.editMyProfile}},[e._v("确 定")])],1)],1),s("div",{on:{click:e.handleEdit}},[s("avatar",{staticClass:"my-avatar",attrs:{src:e.currentUserProfile.avatar}})],1)],1)},Po=[];function jo(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function Mo(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?jo(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):jo(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Io={name:"MyProfile",components:{ImageUpload:As,ElForm:p["Form"],ElFormItem:p["FormItem"],ElRadioGroup:p["RadioGroup"],ElRadio:p["Radio"]},data(){return{showEditMyProfile:!1,form:{avatar:"",nick:"",gender:""}}},computed:Mo(Mo({},Object(c["mapState"])({currentUserId:e=>e.user.userID,currentUserProfile:e=>e.user.currentUserProfile,currentConversation:e=>e.conversation.currentConversation})),{},{gender(){switch(this.currentUserProfile.gender){case this.TIM.TYPES.GENDER_MALE:return"男";case this.TIM.TYPES.GENDER_FEMALE:return"女";default:return"暂无"}}}),methods:{editMyProfile(){if(this.form.avatar&&-1===this.form.avatar.indexOf("http"))return this.$store.commit("showMessage",{message:"头像应该是 Url 地址",type:"warning"}),void(this.form.avatar="");const e={};Object.keys(this.form).forEach(t=>{this.form[t]&&(e[t]=this.form[t])}),this.tim.updateMyProfile(e).then(()=>{this.$store.commit("showMessage",{message:"修改成功"}),this.showEditMyProfile=!1}).catch(e=>{this.$store.commit("showMessage",{message:e.message,type:"error"})})},handleEdit(){const{avatar:e,nick:t,gender:s}=this.currentUserProfile;Object.assign(this.form,{avatar:e,nick:t,gender:s}),this.showEditMyProfile=!0},useQQAvatar(){this.form.avatar=`https://q.qlogo.cn/g?b=qq&nk=${this.currentUserId}&s=100`}}},xo=Io,To=(s("ef8a"),Object(y["a"])(xo,_o,Po,!1,null,"50d16c5e",null)),So=To.exports;function Eo(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function ko(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Eo(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Eo(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Do={components:{MyProfile:So,CreateGroup:Oi},data(){return{showC2CDialog:!1,userID:"",timeout:null}},computed:ko({},Object(c["mapState"])({currentUserId:e=>e.user.userID,currentAppid:e=>e.user.sdkAppID,currentUserProfile:e=>e.user.currentUserProfile,createGroupModelVisible:e=>e.group.createGroupModelVisible})),methods:{handleRefresh(){this.refreshConversation()()},refreshConversation(){let e=this;return function(){e.timeout||(e.timeout=setTimeout(()=>{e.timeout=null,e.tim.getConversationList().then(()=>{e.$store.commit("showMessage",{message:"刷新成功",type:"success"})})},1e3))}},handleCreateChat(e){"c2c"===e?this.showC2CDialog=!0:this.$store.commit("updateCreateGroupModelVisible",!0)},handleCreateC2C(){"@TIM#SYSTEM"!==this.userID?this.$store.dispatch("checkoutConversation","C2C"+this.userID).then(()=>{this.showC2CDialog=!1}).catch(()=>{this.$store.commit("showMessage",{message:"没有找到该用户",type:"warning"})}):this.$store.commit("showMessage",{message:"没有找到该用户",type:"warning"}),this.userID=""}}},$o=Do,Go=(s("985b"),Object(y["a"])($o,Co,wo,!1,null,"0aa28a56",null)),Ao=Go.exports,Lo=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"show",rawName:"v-show",value:e.showPreviewer,expression:"showPreviewer"}],staticClass:"image-previewer-wrapper",on:{mousewheel:e.handleMouseWheel}},[s("div",{staticClass:"image-wrapper"},[s("img",{staticClass:"image-preview",style:{transform:"scale("+e.zoom+") rotate("+e.rotate+"deg)"},attrs:{src:e.previewUrl},on:{click:e.close}})]),s("i",{staticClass:"el-icon-close close-button",on:{click:e.close}}),s("i",{staticClass:"el-icon-back prev-button",on:{click:e.goPrev}}),s("i",{staticClass:"el-icon-right next-button",on:{click:e.goNext}}),s("div",{staticClass:"actions-bar"},[s("i",{staticClass:"el-icon-zoom-out",on:{click:e.zoomOut}}),s("i",{staticClass:"el-icon-zoom-in",on:{click:e.zoomIn}}),s("i",{staticClass:"el-icon-refresh-left",on:{click:e.rotateLeft}}),s("i",{staticClass:"el-icon-refresh-right",on:{click:e.rotateRight}}),s("span",{staticClass:"image-counter"},[e._v(e._s(e.index+1)+" / "+e._s(e.imgUrlList.length))])])])},Ro=[];function Uo(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function No(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?Uo(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Uo(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Bo={name:"ImagePreviewer",data(){return{url:"",index:0,visible:!1,zoom:1,rotate:0,minZoom:.1}},computed:No(No({},Object(c["mapGetters"])(["imgUrlList"])),{},{showPreviewer(){return this.url.length>0&&this.visible},imageStyle(){return{transform:`scale(${this.zoom});`}},previewUrl(){return this.formatUrl(this.imgUrlList[this.index])}}),mounted(){this.$bus.$on("image-preview",this.handlePreview)},methods:{handlePreview({url:e}){this.url=e,this.index=this.imgUrlList.findIndex(t=>t===e),this.visible=!0},handleMouseWheel(e){e.wheelDelta>0?this.zoomIn():this.zoomOut()},zoomIn(){this.zoom+=.1},zoomOut(){this.zoom=this.zoom-.1>this.minZoom?this.zoom-.1:this.minZoom},close(){Object.assign(this,{zoom:1}),this.visible=!1},rotateLeft(){this.rotate-=90},rotateRight(){this.rotate+=90},goNext(){this.index=(this.index+1)%this.imgUrlList.length},goPrev(){this.index=this.index-1>=0?this.index-1:this.imgUrlList.length-1},formatUrl(e){return e?"//"===e.slice(0,2)?"https:"+e:e:""}}},Yo=Bo,Fo=(s("2425"),Object(y["a"])(Yo,Lo,Ro,!1,null,"c65b876c",null)),Vo=Fo.exports;function zo(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function qo(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?zo(Object(s),!0).forEach((function(t){Object(o["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):zo(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var Ho={name:"Main",components:{SideBar:Oo,CurrentConversation:qr,ImagePreviewer:Vo,ProfileBar:Ao},computed:qo(qo({},Object(c["mapState"])({currentConversation:e=>e.conversation.currentConversation})),{},{showCurrentConversation(){return!!this.currentConversation.conversationID}})},Jo=Ho,Wo=(s("a3bb"),Object(y["a"])(Jo,r,i,!1,null,"1d07fd5e",null));t["default"]=Wo.exports},"8e6d":function(e,t,s){"use strict";s("6d42")},9093:function(e,t,s){var r=s("ce10"),i=s("e11e").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},"90b0":function(e,t,s){},9122:function(e,t,s){"use strict";s("7982")},9290:function(e,t,s){},9380:function(e,t,s){},"94e1":function(e,t,s){"use strict";s("ce78")},"985b":function(e,t,s){"use strict";s("e292")},"98e8":function(e,t,s){},9908:function(e,t,s){},"9c50":function(e,t,s){"use strict";s("90b0")},"9c9f":function(e,t,s){},a396:function(e,t,s){},a3bb:function(e,t,s){"use strict";s("8a99")},a672:function(e,t,s){"use strict";s("43c2")},a86b:function(e,t,s){"use strict";s("854e")},b428:function(e,t,s){"use strict";s("fa43")},b849:function(e,t,s){"use strict";s("fbe1")},b8dc:function(e,t,s){},bdf2:function(e,t,s){},bf00:function(e,t,s){"use strict";s("ca6c")},c1f9:function(e,t,s){},c8ad:function(e,t,s){"use strict";s("852a")},c964:function(e,t,s){},ca6c:function(e,t,s){},ce78:function(e,t,s){},d4e4:function(e,t,s){},daca:function(e,t,s){"use strict";s("d4e4")},e017:function(e,t,s){"use strict";s("76e5")},e292:function(e,t,s){},e3ec:function(e,t,s){"use strict";s("53b9")},e4f5:function(e,t,s){"use strict";s("41d8")},e8d4:function(e,t,s){},ec25:function(e,t,s){"use strict";s("6044")},ef8a:function(e,t,s){"use strict";s("f941")},f941:function(e,t,s){},fa43:function(e,t,s){},fbe1:function(e,t,s){},fe90:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAYAAAHfgQuIAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAOKADAAQAAAABAAAAOAAAAAAun0ppAAAG3UlEQVRoBdWav4tcVRTHJ667EIkiK1opDLFQEWxCUoQ0FissgnYWYhO2sVibNOIfsEGwNRbaWWxhUkQhVUBIsBDBRlglNltEFxYWIqwgwR/x+3n7vi9n7tz3Y+bNTJIDZ++5556f98e5d14yGIzCTXU/H2UNBvspQ/1h5H0cOiumMZWFx8W9VY7cSySOxT6Dxp/iwDB2cvSSmHdzAxcTZuXfhMN3SuYnekfdtcdKtqOM7cuMWT0OwP+NP4AFjnrj/YK/XgquWapsL5X8hD0YoJCmOiZUMqoImLTogQFPg5VTXqGcnWlr1LSe5wE5AD8IsVaH3hmFRxSA2Hmr7NtAIVD+iXKRX3kjb0LaFCJcrY/oWrigkQPhrvB0rVQYwPLt0IdcFsLfoZMDBpuAiRmTGWM0WKhkP5LQ8SC4F2iTkVelUlkopdI+7JT3R45Z6jc293zoGqVyg1HxfQkQUhNWNjzF2T1YSd0nLHcZFjP6YTn2lNo6j6XI6ESls/ZPMHDDGmrfFW6FfkGivJoyQ/9r0SN1NYwNNtTBwLbwGeFJIWsGj0oxEbCzUOyCnKi4Czs7ulo6uDOFARbIwZ1o82hHZ9sEO47/VTr3thlRIyoymjWwMbDNOlcAozrVFfeI8PTECpCIFN0mOU4g428jSfmkM29gBxd+2FmLcMhxKarUYSa1b8sgCKQPRtNPu8MthFEulQh9HKF7LRoT7UJQsOumdVqnnyXOzqs/lhTXJcz0zFCaujr+RLIpUBPRz5Y4KgODHNi+QMXG1kgBjjcUDv4UkuETQmfF+UzlxMqCpw7dV4XYei0r2cLkwHrRHUjaXpFMuvFazDYPs5v5MbIr5I3JRrsppHBk10f8iYGrxjs4zSjX5yqbGrxrMXxJ2DRdaxpnrR3EuujO4J2Ksh8fXZWZEW4cdLnqWmEoCUeZnsdW5SBwsbSzH3hjJA5wNosziHEu8cZMnRnCswJnOramG/KAQ27nWYPXdMQuzthlKayIsSdMfwBOIsdGwn51ZKgiMHLlC2eMgU3QJucjU9hwycoZJLMuDtvkOKfYWcIJxDbEnAE/lMHCIRHMG3BI7S0c8sCZN+CQulw4XJm3t9LPXe/M5xOHRNMXefmlsGeHb6YjM+h/lbFxHR6ZcDQiXFOnb4bRHlcb9rjEB1fKDrTBhXxap3wwisB9iq0C7P28GWXL23Jah4mpwk6xQz3AR6MqAjPV8sSb1ClfCiJwiWODmloBJQcmj9YUeNx2dVqUrmDAS7MTeBW5VRrmAZuDG2LmHPPpgm90ObB8bqzgeQrrnNYqZgZ4OeCQN1Ij2GluehsVy8FVtc5s2EUBGU8viunurbNBEfG9hx7rNxGwAbx7MUBx2BSeFFJ7KfhrQq42Z0S7IewFnFMXh2g40gTDy2FhQFA4vCz0CyIG1JVGFxvYwuYDA5aXpYpLHJMgUJb2A+EbQpadJWfpQegXhYwhsy2smxh84AufcwU2+ZYwJgJ9W8jB8c0qsjdgC5vYTv0Rw8QHTjq1MNSIS4+dUYIoJ4sCfPlTiGMgpmGfACi4MTEK8SwKep+Y0CUGXwokS4ytl4NkRiDdig9DYiMBqkNMXk1aYm4FDjIPASuyLWa631sjmEyAsxq3LrHXFiOeU7Eq8sx6VIBYvSjkMPI0JIll4YHQQlSwLhB/8Vq37TtAk90+9ojZMZALOVVwRZQHP6247cRe0LM+vGmhrz3/dCEWHgwFnNFfB8dlO5L5kUjt3xWNMOsEBkLDmxb62iP2+GA4TSBfCJ3gJoxHHMjB+ZBb8d3aDJ5UjzqQg/PZJRk+ypvRZ3th62EAcnA+xaegwxDVk4FOyd+Dog08qJZY6iDmcMhF+XOQPBXolPwmZTzAflMsMYcitwsK1Cux3RD0cxr7O8haZ9EtMTzbECc5OCZyK542sbSuNSi/E5RtZNEtMdQBsTsecqqebf6HAwb5DcbWrYMzGvhPaEOLavGJ7zogZmJ3PGOfNPhnEg8iOPaeE8+wLOK60PLzbvGFzzog1phc9U8+qcKGGA72jujVVCDpcxZm9V8m7De22G46b4RDjMRqPXJohHWNWpj2YqP0/cHXRX4vjLrT0NjAVhcgtuiD2DvBMUldFVqZX9BnO2neF+LD0nvCL4U3hL8KuXNBaHiMIYPsJEAs8Vc9sRLzxDCUxr7QidIya1MZk14fwGe6YsQ27GPUuidExBUlUfY9PzSPC+cF2MZHPGP4JhZimgusy+qOMK4qNFWM35LcRU0VT8NZQAddbMSKaD/4xPdCgRmmJB8IHcisWmxiGx9TwzzO0pKiOSU8J3xF+JLwBSGPYD+EXWxYqVvCX4TfCX8U/iucGfwPlkqurjfJdY8AAAAASUVORK5CYII="}}]);